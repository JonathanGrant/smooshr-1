(this.webpackJsonpsmoosher=this.webpackJsonpsmoosher||[]).push([[0],{110:function(e,t){},112:function(e,t){},152:function(e,t,n){},153:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(34),l=n.n(c),o=(n(92),n(9)),i=n(1),s=n(36),u=n(4);function m(){return r.a.createElement("div",{className:"social"},r.a.createElement("a",{href:"https://twitter.com/tsdataclinic?lang=en",target:"_blank",rel:"noopener noreferrer"},r.a.createElement(u.a,{icon:s.c})),r.a.createElement("a",{href:"https://medium.com/dataclinic",target:"_blank",rel:"noopener noreferrer"},r.a.createElement(u.a,{icon:s.b})),r.a.createElement("a",{href:"https://github.com/tsdataclinic",target:"blank",rel:"noopener noreferrer"},r.a.createElement(u.a,{icon:s.a})))}var p=n(5);function d(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),n=t[0],c=t[1],l=function(){return c(!n)};return r.a.createElement("div",{className:"top-menu"},r.a.createElement(u.a,{className:"hamburger-menu",icon:p.a,onClick:l}),r.a.createElement("div",{className:"menu-links ".concat(n?"":"hidden")},r.a.createElement(u.a,{className:"menu-close-icon",icon:p.o,onClick:l}),r.a.createElement(o.b,{onClick:l,to:"/"},"Projects"),r.a.createElement(o.b,{onClick:l,to:"/about"},"About"),r.a.createElement("a",{onClick:l,target:"_blank",rel:"noopener noreferrer",href:"https://airtable.com/shrMCZrvP7467LNG7"},"Feedback"),r.a.createElement(m,null)))}function f(e){e.history,e.match;return r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"logos"},r.a.createElement(o.b,{style:{display:"flex",alignItems:"center"},to:"/"},r.a.createElement("img",{alt:"Data Clinic Modal",src:"".concat("/smooshr","/DataClinicLogo.png")})," ",r.a.createElement("span",{className:"data-clinic"},"Data Clinic")," "),r.a.createElement("span",{className:"project-name"},"smooshr (beta)")),r.a.createElement("div",{className:"spacer"}),r.a.createElement(d,null))}function E(){return r.a.createElement("svg",{width:"116",height:"21",viewBox:"0 0 230 42",xmlns:"http://www.w3.org/2000/svg"}," ",r.a.createElement("title",null,"Two Sigma"),r.a.createElement("defs",null,r.a.createElement("path",{id:"a",d:"M19.436 21.668V1.025H0v20.643h19.435z"})),r.a.createElement("g",{fill:"none","fill-rule":"evenodd"},r.a.createElement("path",{fill:"#FFFFFF",d:"M59.06 13.464h-7.137v-3.155h17.811v3.155H62.6V30.95h-3.54zm14.01-3.155h3.745l4.747 15.66h.06l4.483-15.66h3.301l4.454 15.66h.059l4.777-15.66h3.716L95.895 30.95H92.09l-4.335-15.127h-.059L83.361 30.95h-3.804zm41.214-.355c5.986 0 10.527 4.158 10.527 10.556 0 6.55-4.541 10.794-10.527 10.794-5.985 0-10.558-4.245-10.558-10.794 0-6.398 4.573-10.556 10.558-10.556m0 18.285c3.892 0 6.93-2.89 6.93-7.729 0-4.658-3.007-7.518-6.93-7.518-3.922 0-6.93 2.86-6.93 7.518 0 4.839 3.038 7.73 6.93 7.73m40.846-17.931h3.539V30.95h-3.54V19.41zm18.744-.355c2.832 0 5.222.885 7.313 2.33 0 0-2.026 2.374-2.128 2.311-1.56-1-3.21-1.574-5.096-1.574-4.247 0-7.048 3.068-7.048 7.433 0 4.746 2.624 7.785 7.048 7.785 1.534 0 3.067-.385 4.13-1.003v-4.897h-5.19v-2.623h8.462v9.347c-2.007 1.416-4.63 2.24-7.49 2.24-6.46 0-10.587-4.363-10.587-10.85 0-6.075 4.187-10.499 10.586-10.499m12.506.355h3.57l6.812 9.701 6.811-9.701h3.541V30.95h-3.421V15.558l-6.962 9.73-6.958-9.73V30.95h-3.392z"}),r.a.createElement("g",{transform:"translate(210.418 9.283)"},r.a.createElement("path",{d:"M7.639 1.025h4.158l7.64 20.643H15.63l-1.561-4.454H5.368l-1.533 4.454H0L7.639 1.025zM6.34 14.354h6.725L9.734 4.74h-.06L6.34 14.354z",fill:"#FFFFFF"})),r.a.createElement("path",{d:"M136.826 26.498c1.861 1.007 3.618 1.68 5.887 1.68 2.715 0 4.069-1.18 4.069-2.83 0-4.66-11.616-1.594-11.616-9.466 0-3.303 2.74-5.928 7.37-5.928 2.714 0 5.443.653 7.579 1.902l-2.314 2.361c-1.68-.72-3.11-1.137-5.146-1.137-2.389 0-3.806 1.21-3.806 2.744 0 4.63 11.62 1.473 11.62 9.494 0 3.393-2.567 5.985-7.756 5.985-3.035 0-6.33-1.076-8.273-2.419l2.386-2.386z",fill:"#FFFFFF"}),r.a.createElement("path",{fill:"#009AA6",d:"M20.625 0L0 20.63l20.625 20.628 20.63-20.628z"}),r.a.createElement("path",{d:"M9.748 26.478c-.16-6.605 7.789-5.746 7.789-9.13 0-1.1-.863-2.041-2.784-2.041-1.401 0-2.743.701-3.724 1.602l-1.46-1.463c1.259-1.18 3.223-2.14 5.284-2.14 3.304 0 4.986 1.842 4.986 4.003 0 4.986-7.728 4.104-7.728 8.27h7.607v1.98h-9.95l-.02-1.081zm15.937-.5c-1.521 0-2.423-.98-2.423-2.862 0-2.404 1.602-4.566 3.525-4.566 1.5 0 2.402.981 2.402 2.883 0 2.401-1.582 4.545-3.504 4.545zm9.713-9.25h-8.444v.003c-3.437.005-6.033 2.745-6.033 6.403 0 2.905 1.881 4.666 4.544 4.666 3.464 0 6.067-2.743 6.067-6.386 0-1.182-.313-2.173-.856-2.935h2.947l1.775-1.75z",fill:"#FFF"})))}function g(){return r.a.createElement("footer",null,r.a.createElement(E,null),r.a.createElement("p",{className:"copyright"},"\xa9 2019 Two Sigma Investments, LP. All rights reserved."),r.a.createElement(m,null))}var h=n(3),b=n(14),v=n.n(b),y=n(35),O=n(24),j=n(6),_=n(80),N=n.n(_),C=n(27),A=n(28),M=n.n(A);var D=n(81),S=n.n(D),w=n(33);var k=function(e,t,n,a,r,c){var l,o=M()(e.name)+".json",i=M()(e.name)+"csv",s=T(e,t,n,a,r,c),u=(l=i,"\nimport pandas as pd \nimport json\nimport sys\n\nwith open('".concat(o,"', 'r') as f:\n    project = json.load(f)\n    datasets = project['datasets']\n\n    all_data = pd.DataFrame()\n\nfor dataset in datasets:\n    dataset_type = dataset['type']\n    dataset_name = dataset['ref']['path']\n    if(dataset_type=='file'):\n        file_path = 'put_your_datasets_in_here/{}'.format(dataset_name)\n        try:\n           print('Raeding {}'.format(dataset_name))\n           data = pd.read_csv(file_path)\n        except:\n           print(\"Place the file {} in the folder put_your_datasets_in_here\".format(file_path))\n           sys.exit()\n    elif(dataset_type['type'] == 'url'):\n        data = pd.read_csv(data['ref']['url'])\n    elif(dataset_Type['type'] == 'open_data'):\n        data = pd.read_csv(data['ref']['url'])\n        \n    print(\"Renaming columns\")\n    column_renames  = dataset['column_renames']\n    data = data.rename(columns=column_renames)\n\n    all_data = all_data.append(data, ignore_index=True)\n\nprint('Applying column mappings')\nfor column,mapping in project['mappings'].items():\n    map_dict = {}\n    for key, values in mapping.items():\n        for value in values:\n            map_dict[value] = key \n            \n    all_data[column] = all_data[column].map(lambda x: map_dict[x] if x in mapping else 'unknown')\n\nprint('Writing out results')\nall_data.to_csv('results/").concat(l,"')\nprint('Datasets have been smooshed')\n    ")),m=new S.a,p=m.folder(e.name);m.folder("".concat(e.name,"/put_your_datasets_in_here")),m.folder("".concat(e.name,"/results")),p.file(o,JSON.stringify(s)),p.file("process.py",u),m.generateAsync({type:"blob"}).then((function(t){Object(C.saveAs)(t,M()(e.name)+"zip")}))},R=function(e,t,n,a,r,c,l){var o={project:e,datasets:t,meta_columns:n,columns:a,mappings:r,entries:c},i="".concat(e.name,".json"),s=new Blob([JSON.stringify(o)],{type:"text/plain;charset=utf-8"});Object(C.saveAs)(s,i)},T=function(e,t,n,a,r,c){var l={name:e.name,description:e.description,id:e.id},o=function(e){var t={};return n.forEach((function(n){n.columns.map((function(e){return a.find((function(t){return t.id===e}))})).filter((function(t){return t.dataset_id===e.id})).forEach((function(e){t[e.name]=n.name}))})),t},i=t.map((function(e){return{type:e.file.type,ref:e.file.ref,rows:e.rows,column_renames:o(e)}})),s={};return n.forEach((function(e){var t=r.filter((function(t){return t.column_id===e.id}));s[e.name]={},t.forEach((function(t){s[e.name][t.name]=t.entries}))})),{project:l,datasets:i,mappings:s,settings:c||{}}};function P(e){var t=e.total,n=e.value,a=e.style;return r.a.createElement("div",{className:"progress-bar",style:a},r.a.createElement("div",{className:"progress-bar-outer"},r.a.createElement("div",{className:"progress-bar-inner",style:{width:"".concat(100*n/t,"%")}})),r.a.createElement("p",{className:"progress-bar-pc"},n?(100*n/t).toPrecision(3):0," %"))}function x(e){var t=e.file,n=e.onAddDataset,c=Object(a.useState)([]),l=Object(i.a)(c,2),o=l[0],s=l[1],u=Object(a.useState)([]),m=Object(i.a)(u,2),p=m[0],d=m[1],f=Object(a.useState)([]),E=Object(i.a)(f,2),g=E[0],b=E[1],v=Object(a.useState)([]),y=Object(i.a)(v,2),O=y[0],_=y[1],C=Object(a.useState)({}),A=Object(i.a)(C,2),M=A[0],D=A[1],S=Object(a.useState)("loading"),k=Object(i.a)(S,2),R=k[0],T=k[1],x=Object(a.useMemo)((function(){return o.reduce((function(e,t){var n=g.filter((function(e){return e.column_id===t.id}));return e[t.id]={entries:n.slice(0,5).map((function(e){return e.name})),extra:n.length-5},e}),{})}),[g,o]);return Object(a.useEffect)((function(){(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:500;return new Promise((function(c,l){var o=0,s={},u=[],m=[],p={},d=e.ref,f=d.size;"file"!==e.type&&(d=d.split("?")[0],d="".concat("https://smooshr.stuartlynn.me","/proxy?url=").concat(d)),N.a.parse(d,{worker:!0,header:!0,download:"file"!==e.type,step:function(e){o<a&&u.push(e.data),0===o&&e.meta.fields.forEach((function(e){s[e]={},p[e]=0})),(o+=1)%n===0&&t&&t({rows_read:o,bytes_read:e.meta.cursor,total_size:f}),e.meta.fields.forEach((function(t){var n=e.data[t];n!==t&&(n in s[t]?s[t][n]+=1:p[t]<r?(s[t][n]=1,p[t]+=1):m.includes(t)||m.push(t))}))},error:function(e){console.log("something bad happened ",e)},complete:function(){var t=[],n=[],a=w();Object.keys(s).forEach((function(e){var r=w();t.push({unique:Object.keys(s[e]).length,id:r,name:e,key:e,dataset_id:a,type:"text",exceded:m.includes(e)}),Object.entries(s[e]).forEach((function(e){var t=Object(i.a)(e,2),a=t[0],c=t[1];return n.push({column_id:r,name:a,count:c})}))})),c({dataset:{id:a,name:"url"===e.type?e.ref.split("?")[0]:e.ref.name,file:e,row_count:o,sample:u},columns:t,entries:n})}})}))})(t,(function(e){return D(e)})).then((function(e){T("selecting"),d(e.dataset),s(e.columns),b(e.entries)}))}),[t]),r.a.createElement("div",{className:"file-snapshot"},r.a.createElement("div",{className:"file-snapshot-header"},r.a.createElement("h3",null,"url"===t.type?t.ref:t.ref.name),"loading"===R&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Loading, parsed"," ",M.rows_read?M.rows_read.toLocaleString():0," ","rows"),r.a.createElement(P,{total:M.total_size?M.total_size:0,value:M.bytes_read,style:{width:"500px"}})),"selecting"===R&&r.a.createElement("p",null,"Has a total of ",p.row_count," rows and ",o.length," ","columns. Select the columns you want to work with")),"selecting"===R&&r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"column-summary-list "},o.map((function(e){return r.a.createElement("li",{className:"column-preview-card card",key:e.id},r.a.createElement("div",null,r.a.createElement("div",{className:"summary-list-header"},r.a.createElement("h3",null,e.name," ",r.a.createElement("span",null,"".concat(e.exceded?">":""," ").concat(e.unique))),r.a.createElement("input",{type:"checkbox",checked:O.includes(e.id),onChange:function(){return t=e.id,void(O.includes(t)?_(O.filter((function(e){return e!==t}))):_([].concat(Object(j.a)(O),[t])));var t}})),r.a.createElement("p",null,x[e.id].entries.join(", ")+" and ".concat(x[e.id].extra," more"))))}))),r.a.createElement("div",{className:"column-summary-buttons"},r.a.createElement("button",{onClick:function(){var e=o.map((function(e){return Object(h.a)({},e,{focusCol:O.includes(e.id)})})),t=g.filter((function(e){return O.includes(e.column_id)}));n(p,e,t),T("saved")}},"Load"),r.a.createElement("button",{onClick:function(){T("skipping")}},"Cancel"))))}function L(e){var t=e.options,n=e.selected,a=e.onSelected;return r.a.createElement("div",{className:"tabs"},t.map((function(e){return r.a.createElement("p",{className:"tab ".concat(n===e?"selected":""," "),key:e,onClick:function(){return a(e)}},e)})))}function I(e){var t=e.value,n=e.onChange,a=e.prompt,c=e.style;return r.a.createElement("div",{className:"search-bar-container",style:c},r.a.createElement(u.a,{className:"search-icon",icon:p.m}),r.a.createElement("input",{type:"text",className:"search-bar",onChange:function(e){return n(e.target.value)},placeholder:a,value:t}),r.a.createElement(u.a,{className:"clear-icon",onClick:function(){return n("")},icon:p.o}))}function U(e){var t=e.onDataset,n=Object(a.useState)(""),c=Object(i.a)(n,2),l=c[0],o=c[1],s=Object(a.useState)([]),m=Object(i.a)(s,2),d=m[0],f=m[1],E="data.cityofnewyork.us";return Object(a.useEffect)((function(){fetch("".concat("https://api.us.socrata.com/api/catalog/v1?","domains=").concat(E,"&search_context=").concat(E,"&limit=20&only=datasets&q=").concat(l)).then((function(e){return e.json()})).then((function(e){f(e.results)})).catch((function(e){return console.log(e)}))}),[l]),r.a.createElement("div",{className:"open-data-search"},r.a.createElement(I,{style:{marginBottom:"30px"},text:l,onChange:o}),d.map((function(e){return r.a.createElement("p",null,e.resource.name," ",r.a.createElement("span",{className:"open-data-result-controls"}," ",r.a.createElement("a",{href:e.permalink,target:"_blank",rel:"noopener noreferrer"},r.a.createElement(u.a,{icon:p.g}))," ",r.a.createElement(u.a,{onClick:function(){return function(e){t({type:"opendata",ref:"https://data.cityofnewyork.us/api/views/".concat(e.resource.id,"/rows.csv?accessType=DOWNLOAD")})}(e)},icon:p.e}))," ")})))}function F(e){var t=e.onAddDataset,n=Object(a.useState)(null),c=Object(i.a)(n,2),l=c[0],o=c[1],s=Object(a.useState)(null),m=Object(i.a)(s,2),d=m[0],f=m[1],E=Object(a.useState)(null),g=Object(i.a)(E,2),b=g[0],v=g[1],j=Object(a.useState)([]),_=Object(i.a)(j,2),N=_[0],C=_[1],A=Object(a.useState)("file"),M=Object(i.a)(A,2),D=M[0],S=M[1],w=function(){o([{type:"url",ref:b}])},k=function(e){o([e])},R=Object(a.useCallback)((function(e){e.every((function(e){return e.name.split(".").includes("csv")}))?(o(e.map((function(e){return{type:"file",ref:e}}))),C(Object(h.a)({},N,Object(y.a)({},e[0].name,{}))),f(null)):f("Some files are not CSVs, We only support CSVs for now")}),[N]),T=Object(O.a)({onDrop:R}),P=T.getRootProps,I=T.getInputProps,F=T.isDragActive;return r.a.createElement("div",{className:"file-uploader"},l?l.map((function(e){return r.a.createElement(x,{file:e,onAddDataset:t})})):r.a.createElement(r.a.Fragment,null,r.a.createElement(L,{options:["file","url","open data portal"],selected:D,onSelected:function(e){return S(e)}}),r.a.createElement("div",{className:"content"},function(){switch(D){case"url":return r.a.createElement("div",{className:"url-tab"},r.a.createElement(u.a,{icon:p.e}),r.a.createElement("div",null,r.a.createElement("input",{placeholder:"dataseturl",value:b,onChange:function(e){return v(e.target.value)}}),r.a.createElement("button",{disabled:!b,onClick:w},"Submit")));case"open data portal":return r.a.createElement(U,{onDataset:k});default:return r.a.createElement("div",P(),r.a.createElement("div",{className:"file-tab",style:{cursor:"p"}},r.a.createElement(u.a,{icon:p.h}),r.a.createElement("input",I({accept:["text/csv","application/vnd.ms-excel"]})),F?r.a.createElement("p",null,"Drop the files here ... "):r.a.createElement("p",null,"Drag 'n' drop files here or click to load dataset")),d&&r.a.createElement("p",null,d))}}())))}I.defaultProps={style:{}};var V=n(82),G=n(33),z=Object(a.createContext)(),q=new V.a("state");q.version(1).stores({state:"id"});var W={datasets:[],columns:[],entries:[],projects:[],mappings:[],embeddings:[],metaColumns:[],showUploadModal:!1,showApplyMappingsModal:!1,cache_loaded:!1,storage_stats:null,persisting:!1},B=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id";return t.find((function(t){return t[n]===e[n]}))?t.map((function(t){return t[n]===e[n]?e:t})):[].concat(Object(j.a)(t),[e])},J=function(e,t){var n=t.type,a=t.payload;switch(n){case"LOAD_CACHED_STATE":return a;case"ADD_DATASETS":return Object(h.a)({},e,{datasets:[].concat(Object(j.a)(e.datasets),Object(j.a)(a))});case"ADD_OR_REPLACE_DATASET":return Object(h.a)({},e,{datasets:B(a,e.datasets)});case"ADD_OR_REPLACE_ENTRY":return Object(h.a)({},e,{entries:B(a,e.entries,"name")});case"ADD_OR_REPLACE_MAPPING":return Object(h.a)({},e,{mappings:B(a,e.mappings)});case"ADD_OR_REPLACE_METACOLUMN":return Object(h.a)({},e,{metaColumns:B(a,e.metaColumns)});case"ADD_OR_REPLACE_PROJECT":return Object(h.a)({},e,{projects:B(a,e.projects)});case"ADD_OR_REPLACE_COLUMN":return Object(h.a)({},e,{columns:B(a,e.columns)});case"REMOVE DATASET":return Object(h.a)({},e,{datasets:e.datasets.filter((function(e){return e.id!==a}))});case"ADD_EMBEDINGS":return Object(h.a)({},e,{embeddings:a});case"ADD_COLUMNS":return Object(h.a)({},e,{columns:[].concat(Object(j.a)(e.columns),Object(j.a)(a))});case"REMOVE_COLUMN":return Object(h.a)({},e,{columns:e.datasets.filter((function(e){return e.id!==a}))});case"ADD_ENTRIES":return Object(h.a)({},e,{entries:[].concat(Object(j.a)(e.entries),Object(j.a)(a))});case"REMOVE ENTRY":return Object(h.a)({},e,{entries:e.entries.filter((function(e){return e.id!==a}))});case"CREATE_META_COLUMN_FROM_COL_ID":return Object(h.a)({},e,{metaColumns:[].concat(Object(j.a)(e.metaColumns),[{id:a.id,name:e.columns.find((function(e){return e.id===a.col_id})).name,description:e.columns.find((function(e){return e.id===a.col_id})).description,project_id:a.project_id,columns:[a.col_id]}])});case"REMOVE_MAPPINGS_FOR_METACOLUMN":return Object(h.a)({},e,{mappings:e.mappings.filter((function(e){return e.column_id!==a}))});case"REMOVE_META_COLUMNS":return Object(h.a)({},e,{metaColumns:e.metaColumns.filter((function(e){return!a.includes(e.id)}))});case"ADD_META_COLUMNS":return Object(h.a)({},e,{metaColumns:[].concat(Object(j.a)(e.metaColumns),Object(j.a)(a))});case"REMOVE_MAPPING":return Object(h.a)({},e,{mappings:e.mappings.filter((function(e){return e.id!==a}))});case"ADD_MAPPINGS":return Object(h.a)({},e,{mappings:[].concat(Object(j.a)(e.mappings),Object(j.a)(a))});case"ADD_MAPPING":return Object(h.a)({},e,{mappings:[].concat(Object(j.a)(e.mappings),[a])});case"ADD_PROJECT":return Object(h.a)({},e,{projects:[].concat(Object(j.a)(e.projects),[Object(h.a)({id:G()},a)])});case"REMOVE_PROJECT":return Object(h.a)({},e,{projects:e.projects.filter((function(e){return e.id!==a}))});case"UPDATE_PROJECT":return Object(h.a)({},e,{projects:e.projects.map((function(e){return e.id===a.id?Object(h.a)({},e,{},a):e}))});case"ADD ENTRY TO MAPPING":return Object(h.a)({},e,{mappings:e.mappings.map((function(e){return e.id===a.id?Object(h.a)({},e,{entries:[].concat(Object(j.a)(e.entries),[a.entry])}):e}))});case"UPDATE_MAPPING":return Object(h.a)({},e,{mappings:e.mappings.map((function(e){return e.id===a.id?Object(h.a)({},e,{},a.mapping):e}))});case"REMOVE_ENTRIES_FOR_COLUMN":return Object(h.a)({},e,{entries:e.entries.filter((function(e){return e.columnID===a}))});case"REMOVE_META_COLUMN":return Object(h.a)({},e,{meta_columns:e.metaColumns.filter((function(e){return e.id!==a}))});case"UPDATE_META_COLUMN":return Object(h.a)({},e,{meta_columns:e.metaColumns.map((function(e){return e.id===a.id?Object(h.a)({},e,{},a.meta_column):e}))});case"SET_PERSISTING":return Object(h.a)({},e,{persisting:a});case"UPDATE_STORAGE_QUOTA":return Object(h.a)({},e,{storage_stats:a});default:return e}},H=function(){return Object(a.useContext)(z)},Y=function(e){var t=H(),n=Object(i.a)(t,2),a=n[0],r=n[1],c=a.projects.find((function(t){return t.id===e})),l=a.datasets.filter((function(t){return t.project_id===e})),o=a.metaColumns.filter((function(t){return t.project_id===e})),s=o.map((function(e){return e.id})),u=o.reduce((function(e,t){return[].concat(Object(j.a)(e),Object(j.a)(t.columns))}),[]),m=a.mappings.filter((function(e){return s.includes(e.column_id)})),p=a.columns.filter((function(e){return u.includes(e.id)})),d=p.map((function(e){return e.id})),f=a.entries.filter((function(e){return d.includes(e.column_id)}));return{project:c,datasets:l,metaColumns:o,columns:p,mappings:m,deleteProject:function(){p.forEach((function(e){r({type:"DELETE_ENTRIES_FOR_COLUMN",payload:e.id}),r({type:"REMOVE_COLUMN",payload:e.id})})),m.forEach((function(e){r({type:"REMOVE_MAPPING",payload:e.id})})),o.forEach((function(e){r({type:"REMOVE_META_COLUMN",payload:e.id})})),l.forEach((function(e){r({type:"REMOVE_DATASET",payload:e.id})})),r({type:"REMOVE_PROJECT",payload:c.id})},entries:f}},Q=function(e){var t=H(),n=Object(i.a)(t,2),a=n[0],r=n[1],c=a.metaColumns.find((function(t){return t.id===e}));if(!c)return{metaColumn:null,entries:[],mappings:[],embeggins:[],dispatch:r};var l=a.entries.filter((function(e){return c.columns.includes(e.column_id)})),o=Array.from(new Set(l.map((function(e){return e.name})))),s=o.map((function(e){var t=l.filter((function(t){return t.name===e})).reduce((function(e,t){return e+t.count}),0);return{name:e,count:t}})),u=a.mappings.filter((function(e){return e.column_id===c.id})),m=a.embeddings.filter((function(e){return o.includes(e.entry)}));return{metaColumn:c,entries:s,mappings:u,embeddings:m,dispatch:r}},Z=function(){var e=H(),t=Object(i.a)(e,1)[0],n=t.projects,a=t.datasets,r=t.columns;return n.reduce((function(e,t){var n=a.filter((function(e){return e.project_id===t.id})).map((function(e){return e.id})),c=r.filter((function(e){return n.includes(e.id)})),l=r.filter((function(e){return e.project_id===t.id}));return[].concat(Object(j.a)(e),[{project:t,stats:{datasets:a.length,columns:c.length,meta_columns:l.length}}])}),[])},$=function(){var e=H(),t=Object(i.a)(e,1)[0],n=t.storage_stats,a=t.persisting;return n?{persisting:a,quota:n.quota/1e6,usage:n.usage/1e6}:{}},K=function(e){var t=H(),n=Object(i.a)(t,1)[0],a=n.datasets.find((function(t){return t.id===e})),r=n.columns.filter((function(t){return t.dataset_id===e})),c=r.map((function(e){return e.id}));return{dataset:a,columns:r,mappings:n.mappings.filter((function(e){return c.includes(e.columnID)}))}},X=n(33);function ee(e){var t=e.match,n=e.history,a=t.params.projectID,c=function(){return n.goBack()},l=H(),o=Object(i.a)(l,2)[1];return r.a.createElement(v.a,{className:"Modal",overlayClassName:"Overlay",isOpen:!0,onRequestClose:c},r.a.createElement(F,{onAddDataset:function(e,t,n){var r=t.filter((function(e){return e.focusCol})).map((function(e){return{columns:[e.id],name:e.name,description:"",project_id:a,id:X()}}));o({type:"ADD_DATASETS",payload:[Object(h.a)({},e,{project_id:a})]}),o({type:"ADD_COLUMNS",payload:t}),o({type:"ADD_ENTRIES",payload:n}),o({type:"ADD_META_COLUMNS",payload:r}),c()},onClose:c}))}function te(e){e.match;var t=e.history,n=function(){return t.goBack()},c=H(),l=Object(i.a)(c,2)[1],o=Object(a.useState)(),s=Object(i.a)(o,2),u=s[0],m=s[1],p=Object(a.useState)(),d=Object(i.a)(p,2),f=d[0],E=d[1];return r.a.createElement(v.a,{isOpen:!0,className:"Modal",overlayClassName:"Overlay",onRequestClose:n},r.a.createElement("div",{className:"new-project-modal"},r.a.createElement("h1",null,"New Project"),r.a.createElement("p",null,"Project Name"),r.a.createElement("input",{value:u,onChange:function(e){return m(e.target.value)},placeholder:"name"}),r.a.createElement("p",null,"Description"),r.a.createElement("textarea",{value:f,onChange:function(e){return E(e.target.value)},placeholder:"description"}),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{onClick:function(){l({type:"ADD_PROJECT",payload:{name:u,description:f}}),n()}},"Create"),r.a.createElement("button",{className:"cancel-button",onClick:n},"Cancel"))))}var ne=function(e){var t=function(e){return Math.sqrt(e.reduce((function(e,t){return e+t*t}),0))}(e);return e.map((function(e){return e/t}))},ae=function(e,t,n,a){var r=function(e,t,n){var a=e.map((function(e){return n.find((function(t){return e===t.entry}))})).filter((function(e){return e})).map((function(e){return[e.embed,1]})),r=t.map((function(e){return n.find((function(t){return e===t.entry}))})).filter((function(e){return e})).map((function(e){return[e.embed,-1]})),c=a.concat(r).reduce((function(e,t){var n=t[1],a=t[0].map((function(e){return e*n}));return e=0===e.length?a:a.map((function(t,n){return t+e[n]}))}),[]);return ne(c)}(e,t,a);return n.map((function(e){var t,n,c=a.find((function(t){return t.entry===e.name}));if(c){var l=(t=ne(c.embed),n=r,t.reduce((function(e,t,a){return e+(t-n[a])*(t-n[a])}),0));return{suggestion:e.name,dist:l}}return{suggestion:e.name,dist:2e6}})).filter((function(e){return e.dist>0})).filter((function(t){return!e.includes(t.suggestion)})).filter((function(e){return!t.includes(e.suggestion)})).sort((function(e,t){return e.dist>t.dist?1:-1})).slice(0,8)},re=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.name.split(" ").reduce((function(e,a){var r=t.filter((function(e){return e})).find((function(e){return e.key===a.toLocaleLowerCase()}));if(r){var c=r.embedding;n&&(c=ne(c)),e=0===e.length?c:e.map((function(e,t){return e+c[t]}))}return e}),[])},ce=function(e){return function(e){var t=new Set;return e.forEach((function(e){e.name.split(" ").forEach((function(e){t.add(e)}))})),Promise.all(Array.from(t).map((function(e){return fetch("".concat("https://smooshr.stuartlynn.me","/embedding/").concat(e.toLowerCase().replace(/[\W_]+/g,""))).then((function(e){return e.json()})).then((function(e){return e[0]}))})))}(e).then((function(t){return e.map((function(e){return{entry:e.name,embed:re(e,t)}}))}))},le=n(33);function oe(e,t,n,a){var r=le();return a({type:"ADD_MAPPING",payload:{name:n,entries:e,negative_examples:[],column_id:t,id:r}}),r}function ie(e,t,n){n({type:"UPDATE_MAPPING",payload:{id:e.id,mapping:{entries:[].concat(Object(j.a)(e.entries),Object(j.a)(t))}}})}function se(e){e.match;var t=e.history,n=H(),c=Object(i.a)(n,2)[1],l=Object(a.useState)(null),o=Object(i.a)(l,1)[0],s=Object(a.useState)(null),m=Object(i.a)(s,2),d=m[0],f=m[1],E=Object(a.useCallback)((function(e){var t=e[0],n=new FileReader;n.readAsText(t),n.onload=function(e){f(JSON.parse(n.result))}}),[]),g=Object(O.a)({onDrop:E}),h=g.getRootProps,b=g.getInputProps,y=g.isDragActive;return r.a.createElement(v.a,{isOpen:!0,onRequestClose:function(){return t.goBack()},className:"Modal",overlayClassName:"Overlay"},r.a.createElement("div",{className:"load-project-modal"},r.a.createElement("h1",null,d?d.project.name:"Load Project"),r.a.createElement("div",{className:"content"},d?r.a.createElement("div",null,r.a.createElement("section",null,r.a.createElement("header",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},r.a.createElement(u.a,{icon:p.d,style:{marginRight:"20px"}}),r.a.createElement("h2",null,"Datasets")),r.a.createElement("p",null,d.project.description),d.datasets.map((function(e){return r.a.createElement("p",null,e.name)}))),r.a.createElement("section",null,r.a.createElement("header",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},r.a.createElement(u.a,{icon:p.c,style:{marginRight:"20px"}}),r.a.createElement("h2",null,"Columns")),d.meta_columns.map((function(e){return r.a.createElement("p",null,e.name)}))),r.a.createElement("button",{onClick:function(){!function(e,t){var n=e.project,a=e.datasets,r=e.entries,c=e.columns,l=e.mappings,o=e.meta_columns;t({type:"ADD_OR_REPLACE_PROJECT",payload:n}),a.forEach((function(e){t({type:"ADD_OR_REPLACE_DATASET",payload:e})})),c.forEach((function(e){t({type:"ADD_OR_REPLACE_COLUMN",payload:e})})),l.forEach((function(e){t({type:"ADD_OR_REPLACE_MAPPING",payload:e})})),o.forEach((function(e){t({type:"ADD_OR_REPLACE_METACOLUMN",payload:e})})),r.forEach((function(e){t({type:"ADD_OR_REPLACE_ENTRY",payload:e})}))}(d,c),t.goBack()}},"Load")):r.a.createElement("div",Object.assign({className:"file-tab"},h()),r.a.createElement(u.a,{icon:p.h}),r.a.createElement("input",b({accept:["text/csv","application/vnd.ms-excel"]})),y?r.a.createElement("p",null,"Drop the files here ... "):r.a.createElement("p",null,"Drag 'n' drop project file here or click to load project"),o&&r.a.createElement("p",null,o)))))}var ue=n(18);function me(){var e=Object(a.useState)(null),t=Object(i.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){var e=sessionStorage.redirect;if(delete sessionStorage.redirect,e&&e!==window.location.href){var t=e;t="/"+t.split("/").slice(4).join("/"),c(t)}}),[]),n?r.a.createElement(ue.a,{to:n}):r.a.createElement(r.a.Fragment,null)}var pe=n(83),de=n.n(pe);function fe(e){var t=e.file,n=e.columns,c=Object(a.useState)(!0),l=Object(i.a)(c,2),o=l[0],s=l[1],u=Object(a.useState)("pending"),m=Object(i.a)(u,2),p=m[0],d=m[1];return r.a.createElement("div",{className:"apply-mapping"},"pending"===p&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{id:t.name},t.name),r.a.createElement("div",{className:"options"},r.a.createElement("p",null,"Applying mappings to ",n.length," columns"),"Add Columns:"," ",r.a.createElement("input",{type:"checkbox",checked:o,onChange:function(e){return s(e.target.checked)}}),"Treat Unmapped as Unknown: ",r.a.createElement("input",{type:"checkbox"}),r.a.createElement("button",{onClick:function(){d("running");var e=de.a.createWriteStream("processed.txt",{size:22});new Response("StreamSaver is awesome").body.pipeTo(e).then((function(){console.log("SAVED")}),(function(){console.log("ERROR")}))}},"Apply Mapping"))),"running"===p&&r.a.createElement("h2",null,"Running"),"done"===p&&r.a.createElement("h2",null,"Done"))}function Ee(e){var t=e.match,n=e.history,c=Object(a.useState)(null),l=Object(i.a)(c,2),o=l[0],s=l[1],u=Object(a.useState)(null),m=Object(i.a)(u,2),p=m[0],d=m[1],f=t.params.datasetID,E=K(f),g=E.columns,h=E.mappings,b=Object(a.useCallback)((function(e){e.every((function(e){return e.name.split(".").includes("csv")}))?s(e):d("Smoosher currently only supports CSV's please just upload those!")}),[]),y=Object(O.a)({onDrop:b}),j=y.getRootProps,_=y.getInputProps,N=y.isDragActive;return r.a.createElement(v.a,{isOpen:!0,onRequestClose:function(){n.goBack()},className:"Modal",overlayClassName:"Overlay"},p&&r.a.createElement("h1",null,p),o?r.a.createElement("div",null,o.map((function(e){return r.a.createElement(fe,{file:e,columns:g,mappings:h})}))):r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Select files to apply mapping to"),r.a.createElement("div",{className:"file-uploader"},r.a.createElement("div",j(),r.a.createElement("input",_({accept:["text/csv","application/vnd.ms-excel"]})),N?r.a.createElement("p",null,"Drop the files here ... "):r.a.createElement("p",null,"Drag 'n' drop files to apply mapping")))))}function ge(e){var t=e.match,n=e.history,c=function(){return n.goBack()},l=t.params.projectID,o=Y(l),s=o.project,u=o.datasets,m=o.metaColumns,p=o.columns,d=o.mappings,f=Object(a.useState)(!1),E=Object(i.a)(f,2),g=E[0],h=E[1],b=Object(a.useState)(!1),y=Object(i.a)(b,2),O=y[0],j=y[1],_=Object(a.useState)(!0),N=Object(i.a)(_,2),C=N[0],A=N[1],M=Object(a.useState)("unknown"),D=Object(i.a)(M,2),S=D[0],w=D[1];return r.a.createElement(v.a,{className:"Modal",overlayClassName:"Overlay",isOpen:!0,onRequestClose:c},r.a.createElement("div",{className:"code-export-modal"},s&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("h1",null,s.name),r.a.createElement("p",null,"Export Code")),r.a.createElement("div",{className:"code-export-options"},r.a.createElement("span",null,"Change non mapped entries?",r.a.createElement("input",{type:"checkbox",value:g,onChange:function(e){return h(e.target.checked)}})),g&&r.a.createElement("span",null,"Value for non mapped entries?",r.a.createElement("input",{type:"text",value:S,onChange:function(e){return w(e.target.value)}})," "),r.a.createElement("span",null,"Create new columns?"," ",r.a.createElement("input",{type:"checkbox",value:O,onChange:function(e){return j(e.target.checked)}})," "),r.a.createElement("span",null,"Combine datasets in to single file?"," ",r.a.createElement("input",{type:"checkbox",value:C,onChange:function(e){return A(e.target.checked)}})," ")),r.a.createElement("div",{className:"export-instructions"},r.a.createElement("p",null,"Click export to download a zip file with everything you need to apply your mapping."),r.a.createElement("p",null,"The code will do the following:"),r.a.createElement("ul",null,r.a.createElement("li",null,'Load the files you worked on from the "put_your_files_in_here" folder'),r.a.createElement("li",null,"Combine and rename columns from each dataset as you indicated"),r.a.createElement("li",null,"Apply the new taxonomies you produced to those columns"),r.a.createElement("li",null,'Export the results to the "results" folder')),r.a.createElement("p",null,'The script that does all this is called "process.py" you can tweak it to suit your needs')),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{onClick:function(){k(s,u,m,p,d,{changeNonMapped:g,createNewColumns:O,combineDatasets:C,valueForNonMapped:S})}},"Export"),r.a.createElement("button",{onClick:c},"Cancel")))))}var he=n(84),be=n.n(he);function ve(e){var t=e.data,n=Object.keys(t[0]).map((function(e){return{key:e,name:e}})),c=Object(a.useState)(t),l=Object(i.a)(c,2),o=l[0],s=l[1];return 0===t.length?r.a.createElement("h1",null," No data to show"):r.a.createElement(be.a,{columns:n,rowGetter:function(e){return o[e]},rowsCount:t.length,onGridSort:function(e,n){return s(function(e,t,n){return function(a){return"NONE"===n?e:Object(j.a)(a).sort((function(e,a){return"ASC"===n?e[t]>a[t]?1:-1:"DESC"===n?e[t]<a[t]?1:-1:void 0}))}}(t,e,n))}})}function ye(e){var t=e.match.params.datasetID,n=H(),a=Object(i.a)(n,1)[0],c=a.datasets,l=a.columns,o=c.find((function(e){return e.id===t})),s=l.filter((function(e){return e.dataset_id===t}));return o?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"datatable full_card"},r.a.createElement(ve,{data:o.sample,columns:s}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-around",marginTop:"20px"}}))):r.a.createElement("h2",null,"Could not find dataset")}function Oe(e){var t=e.entry,n=e.selected,a=void 0!==n&&n,c=e.onToggleSelect;return r.a.createElement("div",{className:"entry-card card ".concat(a?"selected":""),onClick:function(){return c(t)}},r.a.createElement("h3",null,t.name),r.a.createElement("p",null,t.count," occurrences"))}function je(e){var t=e.onChange,n=Object(a.useState)(!1),c=Object(i.a)(n,2),l=c[0],o=c[1],s=Object(a.useState)("Alphabetically"),m=Object(i.a)(s,2),d=m[0],f=m[1];return r.a.createElement("div",{className:"order-by"},r.a.createElement("p",null,"Order By: "),r.a.createElement("ul",null,r.a.createElement("li",{onClick:function(){o(!0)}},d," ",r.a.createElement(u.a,{icon:p.n})," "),["Alphabetically","Occurances"].filter((function(e){return e!==d&&l})).map((function(e){return r.a.createElement("li",{onClick:function(){return n=e,o(!1),f(n),void(t&&t(n));var n}},e)}))))}function _e(e){var t=e.entry,n=e.onRemove;return r.a.createElement("span",{className:"entry-pill"},r.a.createElement("span",null,t),r.a.createElement(u.a,{icon:p.o,onClick:function(){return n(t)}}))}function Ne(e){var t=e.selection,n=e.onRemoveSelection,a=e.onClearAll;return r.a.createElement("div",{className:"selected-entry-list"},0===t.length?r.a.createElement("span",null,"Click on entries to select them"):r.a.createElement("span",null,"Selections (",t.length,"):"),r.a.createElement("ul",null,t.reverse().map((function(e){return r.a.createElement("li",null,r.a.createElement(_e,{onRemove:n,entry:e})," ")}))),t.length>0&&r.a.createElement("button",{className:"clear-all text-button",onClick:a},"Clear All"))}function Ce(e){var t=e.entries,n=e.style,c=e.onToggleSelection,l=e.onClearSelection,o=e.selection,s=Object(a.useState)("Occurances"),m=Object(i.a)(s,2),d=m[0],f=m[1],E=function(e){c&&c(e)},g={Alphabetically:"name",Occurances:"count"}[d],h=t.sort((function(e,t){return e[g]>t[g]?1:-1}));return"count"===g&&h.reverse(),r.a.createElement("div",{style:n,className:"entry-table"},r.a.createElement("div",{className:"entry-table-filters"},r.a.createElement(Ne,{selection:o,onRemoveSelection:E,onClearAll:l}),r.a.createElement(je,{onChange:function(e){return f(e)}})),r.a.createElement("div",{className:"entry-table-entries"},h.length>0?h.map((function(e){return r.a.createElement(Oe,{key:e.name,entry:e,selected:o.includes(e.name),onToggleSelect:E})})):r.a.createElement("div",{className:"all-done"},r.a.createElement("h1",null,"You really smooshed the crap out of that column."),r.a.createElement("h1",null,Object(j.a)(Array(5)).map((function(){return r.a.createElement(u.a,{icon:p.j})}))))))}function Ae(e){var t=e.text,n=e.onUpdate,c=Object(a.useState)(t),l=Object(i.a)(c,2),o=l[0],s=l[1],m=Object(a.useState)(!1),d=Object(i.a)(m,2),f=d[0],E=d[1];return Object(a.useEffect)((function(){s(t)}),[t]),f?r.a.createElement("input",{onChange:function(e){return s(e.target.value)},onBlur:function(){E(!1),n(o)},value:o}):r.a.createElement("h3",null,o," ",r.a.createElement(u.a,{onClick:function(){return E(!0)},icon:p.f}))}function Me(e){var t=e.mapping,n=e.onRemoveEntryFromMapping,c=e.onRenameMapping,l=e.onClearMapping,o=e.onDeleteMapping,s=e.onAddSuggestionToMapping,m=e.onAddNegativeExampleToMapping,d=e.suggestions,f=e.style,E=Object(a.useState)("text"),g=Object(i.a)(E,2),h=g[0],b=g[1],v=d[h];return r.a.createElement("div",{className:"mapping-focus",style:f},r.a.createElement(Ae,{text:t.name,onUpdate:function(e){c&&c(t,e)}}),r.a.createElement("div",{className:"include-list"},r.a.createElement("h4",null,"Includes"),r.a.createElement("ul",null,t.entries.map((function(e){return r.a.createElement("li",null,e," ",r.a.createElement("button",{onClick:function(){return function(e){n&&n(e,t)}(e)},className:"small-button round-button"},r.a.createElement(u.a,{icon:p.o})," "))})))),r.a.createElement("div",{className:"keyword-match"},r.a.createElement("h4",null,"Suggestions by:"," ",r.a.createElement("span",{style:"text"===h?{fontWeight:"bold"}:{fontWeight:"lighter"},onClick:function(){return b("text")}},"text")," ","/"," ",r.a.createElement("span",{style:"meaning"===h?{fontWeight:"bold"}:{fontWeight:"lighter"},onClick:function(){return b("meaning")}},"meaning")),r.a.createElement("ul",null,v.map((function(e){return r.a.createElement("li",null,e.suggestion," ",r.a.createElement("div",{className:"SuggestionActionButtons"},r.a.createElement("button",{className:"small-button round-button",onClick:function(){return function(e){s&&s(e.suggestion)}(e)}},r.a.createElement(u.a,{icon:p.b})),r.a.createElement("button",{className:"small-button round-button",onClick:function(){return function(e){m&&m(e.suggestion)}(e)}},r.a.createElement(u.a,{icon:p.o}))))})))),r.a.createElement("div",{className:"ActionButtons"},r.a.createElement("button",{onClick:function(e){l&&l(t)},className:"mid-button"},"Clear Mapping"),r.a.createElement("button",{onClick:function(e){o&&o(t)},className:"mid-button"},"Delete Mapping")))}function De(e){var t=e.mappings,n=void 0===t?[]:t,a=e.selected,c=e.onMappingSelected,l=e.style;return r.a.createElement("div",{class:"mappings-menu",style:l},r.a.createElement("h3",null,"Merged Groups ",r.a.createElement("span",{class:"Pill"},n.length)," "),r.a.createElement("ul",null,n.map((function(e){return r.a.createElement("li",{className:a&&e.name===a.name?"selected":"",onClick:function(){return function(e){c&&c(e)}(e)}},e.name)}))))}function Se(e){var t=e.mappings,n=e.selection,a=e.onMappingSelected,c=e.onRenameMapping,l=e.onRemoveEntryFromMapping,o=e.onDeleteMapping,i=e.onClearMapping,s=e.onAddEntryToMapping,u=e.onAddSuggestionToMapping,m=e.onAddNegativeExampleToMapping,p=e.suggestions,d=e.style;return r.a.createElement("div",{className:"mappings-area",style:d},r.a.createElement(De,{mappings:t,selected:n,onMappingSelected:a}),n&&r.a.createElement(Me,{mapping:n,onRemoveEntryFromMapping:l,onRenameMapping:c,onDeleteMapping:o,onClearMapping:i,onAddEntryToMapping:s,onAddSuggestionToMapping:u,suggestions:p,onAddNegativeExampleToMapping:m}))}ve.defaultProps={data:[],columns:[]},Ne.defaultProps={selection:[]},Ce.defaultProps={style:{}},Me.defaultProps={style:{},meaningSuggestions:[],textSuggestions:[]},De.defaultProps={mappings:[],style:{}},Se.defaultProps={style:{}};var we=n(85),ke=n.n(we),Re=n(86),Te={},Pe=function(e,t){var n=[];return e.forEach((function(a){t.forEach((function(t){var r=[a,t.name].join("_");if(!e.includes(t))if(Te[r])n.push({suggestion:t.name,score:Te[r]});else{var c=Re.get(a,t.name);Te[r]=c,n.push({suggestion:t.name,score:c})}}))})),n.sort((function(e,t){return e.score>t.score?1:-1})).slice(0,5)};function xe(e){var t=e.match,n=Object(a.useState)(null),c=Object(i.a)(n,2),l=c[0],o=c[1],s=Object(a.useState)(null),u=Object(i.a)(s,2),m=u[0],p=u[1],d=Object(a.useState)([]),f=Object(i.a)(d,2),E=f[0],g=f[1],h=t.params.columnID,b=Q(h),v=b.entries,y=b.mappings,O=b.embeddings,_=b.dispatch,N=y.find((function(e){return e.id===m}));Object(a.useEffect)((function(){v&&function(e,t){ce(e).then((function(e){t({type:"ADD_EMBEDINGS",payload:e})}))}(v,_)}),[JSON.stringify(v)]);var C=v.filter((function(e){return!y.some((function(t){return t.entries.includes(e.name)}))})),A=ke()({data:C,options:{shouldSort:!0,findAllMatches:!0,keys:["name"],caseSensitive:!1}}),M=A.result,D=A.search,S=M,w=function(){g([])},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];ie(N,e,_),t&&w()},R=function(e){o(e),D(e)},T=O&&N,P=T?ae(N.entries,N.negative_examples,C,O):[],x={text:T?Pe(N.entries,C):[],meaning:P},L=H().cache_loaded,U={mappings:y.length,total_rows:v.reduce((function(e,t){return e+t.count}),0),total_mapped_rows:y.map((function(e){return e.entries.reduce((function(e,t){return e+v.find((function(e){return e.name===t})).count}),0)})).reduce((function(e,t){return e+t}),0),total_entries_in_mappings:y.reduce((function(e,t){return e+t.entries.length}),0)};return L?r.a.createElement("h1",null,"Loading"):r.a.createElement("div",{className:"column-page"},r.a.createElement(I,{style:{gridArea:"header",width:"50%",justifySelf:"center"},onChange:R,onClear:function(){return R("")},value:l,prompt:"Search for entries by typing here..."}),r.a.createElement(Ce,Object.assign({entries:S,style:{gridArea:"table",overflowY:"hidden",width:"100%",height:"100%"},onToggleSelection:function(e){var t="string"==typeof e?e:e.name;E.includes(t)?g(E.filter((function(e){return e!==t}))):g([].concat(Object(j.a)(E),[t]))},selection:E,onClearSelection:w},v)),r.a.createElement("div",{className:"stats-and-actions"},r.a.createElement("div",{className:"stats"},r.a.createElement("p",null,r.a.createElement("span",null,U.total_entries_in_mappings)," /"," ",r.a.createElement("span",null,v.length)," entries |"," ",r.a.createElement("span",null,U.total_mapped_rows)," /"," ",r.a.createElement("span",null,U.total_rows)," rows")),r.a.createElement("div",{className:"entry-action-buttons"},r.a.createElement("button",{disabled:0===E.length,onClick:function(){var e=oe(E,h,E[0],_);g([]),p(e)}},"New Mapping ",E.length),r.a.createElement("button",{disabled:!(E.length>0&&m),onClick:function(){return k(E,!0)}},"Add to Mapping"),r.a.createElement("button",{onClick:function(){return oe(C,h,"Other",_)}},"Map Remaining To Other"))),r.a.createElement(Se,Object.assign({mappings:y,selection:y.find((function(e){return e.id===m})),style:{gridArea:"mappings"},onMappingSelected:function(e){return p(e.id)},onRenameMapping:function(e,t){!function(e,t,n){n({type:"UPDATE_MAPPING",payload:{mapping:{name:t},id:e.id}})}(e,t,_)},onRemoveEntryFromMapping:function(e,t){!function(e,t,n){n({type:"UPDATE_MAPPING",payload:{id:e.id,mapping:{entries:e.entries.filter((function(e){return e!==t}))}}})}(t,e,_)},onDeleteMapping:function(e){!function(e,t){t({type:"REMOVE_MAPPING",payload:e.id})}(e,_)},onClearMapping:function(e){!function(e,t){t({type:"UPDATE_MAPPING",payload:{id:e.id,mapping:{entries:[]}}})}(e,_)},suggestions:x,onAddSuggestionToMapping:function(e){return k([e])},onAddNegativeExampleToMapping:function(e){!function(e,t,n){n({type:"UPDATE_MAPPING",payload:{id:e.id,mapping:{negative_examples:[].concat(Object(j.a)(e.negative_examples),[t])}}})}(N,e,_)}},y,{syle:{height:"300px"}})))}function Le(e){var t=e.project,n=e.stats;return r.a.createElement("div",{className:"project-card card"},r.a.createElement("h2",{className:"title"},t.name),r.a.createElement("p",{className:"description"},t.description),r.a.createElement("div",{className:"project-card-stats"},r.a.createElement("span",null,n.columns," ",r.a.createElement(u.a,{icon:p.c})),r.a.createElement("span",null,n.datasets," ",r.a.createElement(u.a,{icon:p.d})),r.a.createElement("span",null,n.meta_columns," ",r.a.createElement(u.a,{icon:p.d}))))}var Ie=function(e){var t=e.prompt,n=e.icon;return r.a.createElement("div",{className:"project-card card new-project-card"},r.a.createElement("h2",{className:"title"},t),r.a.createElement(u.a,{icon:n,size:"3x"}))};function Ue(){var e=Z(),t=$(),n=t.quota,a=t.usage;return r.a.createElement("div",{className:"welcome-page page"},r.a.createElement("header",{className:"welcome-page-header"},r.a.createElement("h1",{className:"large-title-header"},"smooshr"),r.a.createElement("p",null,"Wrangle those messy datasets"),r.a.createElement("p",{className:"feedback"},"We need your help to make smooshr better! Try out our"," ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/tsdataclinic/smooshr/blob/master/tutorial.md"},"tutorial")," ","and leave your thoughts on our"," ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://airtable.com/shrMCZrvP7467LNG7"},"feedback form"))),e&&r.a.createElement("div",{className:"projects-area"},r.a.createElement("div",{className:""},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,"local projects")),r.a.createElement("div",{className:"region-list"},e.map((function(e){return r.a.createElement(o.b,{to:"/project/".concat(e.project.id)},r.a.createElement(Le,{project:e.project,stats:e.stats}))})),r.a.createElement(o.b,{to:"/new_project"},r.a.createElement(Ie,{prompt:"New Project",icon:p.l})),r.a.createElement(o.b,{to:"/load_project"},r.a.createElement(Ie,{prompt:"Load Project",icon:p.p}))))),r.a.createElement("div",{className:"storage"},r.a.createElement("p",null,"smooshr processes and stores all data locally on your machine."),n&&r.a.createElement("p",null,"It is currently using ",a.toLocaleString()," Mb of"," ",n.toLocaleString()," Mb.")))}function Fe(){return r.a.createElement("div",{className:"about-page"},r.a.createElement("section",null,r.a.createElement("h2",null,"What is smooshr?"),r.a.createElement("p",null,"Introducing smooshr, a quick and friendly way to clean messy datasets."),r.a.createElement("p",null,"Datasets can be messy and as data scientists, data journalists, civic technologists or just the curious people, we spend a lot of our time trying to clean it up. That's why we built smooshr, a browser based tool that aids you in producing code that can quickly clean up unruly datasets."),r.a.createElement("p",null,"Our first release focuses on entity consolidation tasks but we have plans to extend this to other forms of data cleaning in the near future.")),r.a.createElement("section",null,r.a.createElement("h2",null,"What is Data Clinic?"),r.a.createElement("p",null,"As the data and tech philanthropic arm of Two Sigma, Data Clinic provides pro bono data science and engineering support to nonprofits and engages in open source tooling and research that contribute to the Data for Good movement."),r.a.createElement("p",null,"We leverage Two Sigma\u2019s people, data science skills, and technological know-how to support communities, mission driven organizations, and the broader public in their effort to use data more effectively."),r.a.createElement("p",null,"To learn more visit"," ",r.a.createElement("a",{href:"dataclinic.twosigma.com"},"dataclinic.twosigma.com")," ","and connect with us via"," ",r.a.createElement("a",{href:"mailto:dataclinic@twosigma.com"},"dataclinic@twosigma.com"),".")),r.a.createElement("section",null,r.a.createElement("h2",null,"How can I get involved?"),r.a.createElement("p",null,"smooshr is an open source project which means anyone can help make it better. To log bugs, suggest features or to directly help improve the code, head over to our github page at"," ",r.a.createElement("a",{href:"https://github.com/tsdataclinic/smooshr/"},"github.com/tsdataclinic/smooshr")),r.a.createElement("p",null,"We leverage Two Sigma\u2019s people, data science skills, and technological know-how to support communities, mission driven organizations, and the broader public in their effort to use data more effectively."),r.a.createElement("p",null,"To learn more visit"," ",r.a.createElement("a",{href:"dataclinic.twosigma.com"},"dataclinic.twosigma.com")," ","and connect with us via"," ",r.a.createElement("a",{href:"mailto:dataclinic@twosigma.com"},"dataclinic@twosigma.com"),".")))}function Ve(e){var t=e.name,n=e.description,a=e.fromColumns,c=e.selected,l=e.onClick,i=e.onUpdate,s=e.onUnmerge,u=e.link,m=a.reduce((function(e,t){return e+t.unique}),0);return r.a.createElement("div",{onClick:l,className:"column-card card ".concat(c?"selected":"")},r.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},r.a.createElement(Ae,{text:t,onUpdate:i}),r.a.createElement("h2",null,m)),r.a.createElement("p",{className:"description"},n),a.map((function(e){return r.a.createElement("p",{key:e.name},e.name," | ",e.dataset.name)})),r.a.createElement("div",{className:"column-action-buttons"},a.length>1&&r.a.createElement("button",{onClick:s},"Split Column"),r.a.createElement(o.b,{className:"work-on-taxonomy-button",to:u},r.a.createElement("button",null,"Work on taxonomy"))))}function Ge(e){var t=e.match,n=e.history,c=t.params.projectID,l=Y(c),s=l.project,m=l.datasets,d=l.metaColumns,f=l.columns,E=l.mappings,g=l.entries,h=l.deleteProject,b=Object(a.useState)(m&&m.length>0?m[0].name:null),v=Object(i.a)(b,2),y=v[0],O=v[1];Object(a.useEffect)((function(){m.length>0&&!y&&O(m[0].name)}),[m,y]);var _=m.find((function(e){return e.name===y})),N=H(),C=Object(i.a)(N,2)[1],A=Object(a.useState)([]),M=Object(i.a)(A,2),D=M[0],S=M[1],w=function(e){!function(e,t){e.columns.forEach((function(n){t({type:"CREATE_META_COLUMN_FROM_COL_ID",payload:{col_id:n,id:le(),project_id:e.project_id}})})),t({type:"REMOVE_META_COLUMNS",payload:[e.id]}),t({type:"REMOVE_MAPPINGS_FOR_METACOLUMN",payload:e.id})}(d.find((function(t){return t.id===e})),C)},k=function(e){var t=f.find((function(t){return t.id===e}));return{dataset:m.find((function(e){return e.id===t.dataset_id})),name:t.name,id:t.id,unique:t.unique}};return r.a.createElement("div",{className:"project-page page"},s?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"actions"},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,r.a.createElement(u.a,{icon:p.i,style:{marginRight:"20px"}}),"Actions"),r.a.createElement("div",{className:""},r.a.createElement("button",{onClick:function(){R(s,m,d,f,E,g,{})}},"Export Project"),r.a.createElement(o.b,{to:"/project/".concat(c,"/export")},r.a.createElement("button",null,"Export Python code")),r.a.createElement("button",{onClick:function(){h(),n.push("/")}},"Delete Project")))),r.a.createElement("div",{className:"metadata"},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,r.a.createElement(u.a,{icon:p.k,style:{marginRight:"20px"}}),"Metadata"),r.a.createElement("div",{className:"properties"},r.a.createElement("p",null,"Name: ",s.name),r.a.createElement("p",null,"Description: ",s.description)))),r.a.createElement("div",{className:"columns region"},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,r.a.createElement(u.a,{icon:p.c,style:{marginRight:"20px"}}),"Columns"),D.length>0?r.a.createElement("button",{onClick:function(){!function(e,t){var n=e[0],a=e.map((function(e){return e.id}));e.slice(1).forEach((function(e){n.columns=[].concat(Object(j.a)(n.columns),Object(j.a)(e.columns))})),t({type:"REMOVE_META_COLUMNS",payload:a}),t({type:"ADD_META_COLUMNS",payload:[n]})}(d.filter((function(e){return D.includes(e.id)})),C),S([])}},"Merge ".concat(D.length," columns")):""),r.a.createElement("div",{className:"region-list column-list"},d.map((function(e){return r.a.createElement(Ve,{name:e.name,description:e.description,fromColumns:e.columns.map(k),selected:D.includes(e.id),onClick:function(){return t=e.id,void(D.includes(t)?S(D.filter((function(e){return e!==t}))):S([].concat(Object(j.a)(D),[t])));var t},onUpdate:function(t){return function(e,t){!function(e,t,n){n({type:"UPDATE_META_COLUMN",payload:{id:e,meta_column:t}})}(e.id,{name:t},C)}(e,t)},onUnmerge:function(){return w(e.id)},link:"/project/".concat(s.id,"/column/").concat(e.id),key:e.id})})))),r.a.createElement("div",{className:"datasets region"},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,r.a.createElement(u.a,{icon:p.d,style:{marginRight:"20px"}}),"Datasets")),r.a.createElement("div",{className:"dataset-table-view"},r.a.createElement("div",{className:"dataset-tabs"},m.map((function(e,t){return r.a.createElement("p",{key:e.name,className:y===e.name?"selected-dataset dataset-tab":"dataset-tab",onClick:function(){return O(e.name)}},r.a.createElement("span",{className:"dataset-number"},t+1)," ",r.a.createElement("span",{className:"dataset-name"},e.name))})),r.a.createElement("p",{className:"final-dataset dataset-tab"},"Result"),r.a.createElement("div",{className:"spacer"}),r.a.createElement(o.b,{to:"/project/".concat(c,"/add_datasets"),className:"add-dataset dataset-tab"},r.a.createElement(u.a,{icon:p.l}),r.a.createElement("span",{className:"dataset-name"},"Add Dataset"))),r.a.createElement("div",{className:"table"},m.length>0&&_&&r.a.createElement(ve,{data:_.sample,columns:_.columns}))))):r.a.createElement("h1",null,"Project not found"))}n(151),n(152);var ze=function(){return r.a.createElement(o.a,{basename:"/smooshr"},r.a.createElement(me,null),r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"main"},r.a.createElement(ue.b,{path:"/project/:projectID/dataset/:datasetID",exact:!0,component:ye}),r.a.createElement(ue.b,{path:"/project/:projectID/column/:columnID",exact:!0,component:xe}),r.a.createElement(ue.b,{path:"/project/:projectID",exact:!0,component:Ge}),r.a.createElement(ue.b,{path:"/about",exact:!0,component:Fe}),r.a.createElement(ue.b,{path:"/",exact:!0,component:Ue})),r.a.createElement(g,null),r.a.createElement(ue.b,{path:"/",component:f}),r.a.createElement(ue.b,{path:"/new_project",component:te}),r.a.createElement(ue.b,{path:"/load_project",component:se}),r.a.createElement(ue.b,{path:"/project/:projectID/export",component:ge}),r.a.createElement(ue.b,{path:"/project/:projectID/add_datasets",component:ee}),r.a.createElement(ue.b,{path:"/dataset/:datasetID/apply",component:Ee})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement((function(e){var t=e.children,n=Object(a.useReducer)(J,W),c=Object(i.a)(n,2),l=c[0],o=c[1],s=l.datasets,u=l.columns,m=l.entries,p=l.projects,d=l.mappings,f=l.metaColumns,E=l.showUploadModal,g=l.showApplyMappingsModal,b=l.cache_loaded;return Object(a.useEffect)((function(){b&&(q.state.put({data:JSON.stringify({datasets:s,columns:u,entries:m,projects:p,mappings:d,metaColumns:f,showUploadModal:E,showApplyMappingsModal:g}),id:1}),navigator.storage&&navigator.storage.estimate?navigator.storage.estimate().then((function(e){var t=e.quota,n=e.usage;o({type:"UPDATE_STORAGE_QUOTA",payload:{quota:t,usage:n}})})):console.error("StorageManager not found"))}),[s,u,m,p,d,f,E,g,b]),Object(a.useEffect)((function(){q.state.get(1).then((function(e){if(e){var t=JSON.parse(e.data);o({type:"LOAD_CACHED_STATE",payload:Object(h.a)({},W,{},t,{cache_loaded:!0})})}else o({type:"LOAD_CACHED_STATE",payload:Object(h.a)({},W,{cache_loaded:!0})})}))}),[]),Object(a.useEffect)((function(){navigator.storage&&navigator.storage.persist&&navigator.storage.persist().then((function(e){o({type:"SET_PERSISTING",payload:e})}))}),[]),r.a.createElement(z.Provider,{value:[l,o]},t)}),null,r.a.createElement(ze,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},87:function(e,t,n){e.exports=n(153)},92:function(e,t,n){}},[[87,1,2]]]);
//# sourceMappingURL=main.5c524861.chunk.js.map