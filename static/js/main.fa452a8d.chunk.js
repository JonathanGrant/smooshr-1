(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{203:function(e,t,n){e.exports=n(360)},208:function(e,t,n){},209:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},213:function(e,t){},215:function(e,t){},245:function(e,t){},246:function(e,t){},359:function(e,t,n){},360:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(81),o=n.n(c),l=(n(208),n(4)),i=(n(209),n(20)),s=n(30),u=n(12),m=(n(201),n(1),function(e){var t=function(e){return Math.sqrt(e.reduce(function(e,t){return e+t*t},0))}(e);return e.map(function(e){return e/t})}),p=function(e,t,n,a){var r=function(e,t,n){var a=e.map(function(e){return n.find(function(t){return e===t.entry})}).filter(function(e){return e}).map(function(e){return[e.embed,1]}),r=t.map(function(e){return n.find(function(t){return e===t.entry})}).filter(function(e){return e}).map(function(e){return[e.embed,-1]}),c=a.concat(r).reduce(function(e,t){var n=t[1],a=t[0].map(function(e){return e*n});return e=0==e.length?a:a.map(function(t,n){return t+e[n]})},[]);return m(c)}(e,t,a);return n.map(function(e){var t,n,c=a.find(function(t){return t.entry==e.name});if(c){var o=(t=m(c.embed),n=r,t.reduce(function(e,t,a){return e+(t-n[a])*(t-n[a])},0));return{suggestion:e.name,dist:o}}return console.log("failed to find ",e),{suggestion:e.name,dist:2e6}}).filter(function(e){return e.dist>0}).filter(function(t){return!e.includes(t.suggestion)}).filter(function(e){return!t.includes(e.suggestion)}).sort(function(e,t){return e.dist>t.dist?1:-1}).slice(0,8)},d=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.name.split(" ").reduce(function(e,a){var r=t.filter(function(e){return e}).find(function(e){return e.key==a.toLocaleLowerCase()});if(console.log("word emebed is ",r),r){var c=r.embedding;n&&(c=m(c)),e=0==e.length?c:e.map(function(e,t){return e+c[t]})}return e},[])},f=function(e){return function(e){var t=new Set;return e.forEach(function(e){e.name.split(" ").forEach(function(e){t.add(e)})}),Promise.all(Array.from(t).map(function(e){return fetch("".concat("https://smooshr.stuartlynn.me","/embedding/").concat(e.toLowerCase().replace(/[\W_]+/g,""))).then(function(e){return e.json()}).then(function(e){return e[0]})}))}(e).then(function(t){return e.map(function(e){return{entry:e.name,embed:d(e,t)}})})},E=n(79);function g(e,t,n,a){var r=E();return a({type:"ADD_MAPPING",payload:{name:n,entries:e,negative_examples:[],column_id:t,id:r}}),r}var h=n(188);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=n(79),v=Object(a.createContext)(),j=new h.a("state");j.version(1).stores({state:"id"});var _={datasets:[],columns:[],entries:[],projects:[],mappings:[],embeddings:[],metaColumns:[],showUploadModal:!1,showApplyMappingsModal:!1,cache_loaded:!1,storage_stats:null,persisting:!1},C=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id";return console.log("id col before default is ",n),console.log("loading ",e," with id col ",n),t.find(function(t){return t[n]===e[n]})?t.map(function(t){return t[n]===e[n]?e:t}):[].concat(Object(u.a)(t),[e])},N=function(e,t){console.log("DISPATCHING ",t.type);var n=t.type,a=t.payload;switch(n){case"LOAD_CACHED_STATE":return a;case"ADD_DATASETS":return O({},e,{datasets:[].concat(Object(u.a)(e.datasets),Object(u.a)(a))});case"ADD_OR_REPLACE_DATASET":return O({},e,{datasets:C(a,e.datasets)});case"ADD_OR_REPLACE_ENTRY":return O({},e,{entries:C(a,e.entries,"name")});case"ADD_OR_REPLACE_MAPPING":return O({},e,{mappings:C(a,e.mappings)});case"ADD_OR_REPLACE_METACOLUMN":return O({},e,{metaColumns:C(a,e.metaColumns)});case"ADD_OR_REPLACE_PROJECT":return O({},e,{projects:C(a,e.projects)});case"ADD_OR_REPLACE_COLUMN":return O({},e,{columns:C(a,e.columns)});case"REMOVE DATASET":return O({},e,{datasets:e.datasets.filter(function(e){return e.id!==a})});case"ADD_EMBEDINGS":return O({},e,{embeddings:a});case"ADD_COLUMNS":return O({},e,{columns:[].concat(Object(u.a)(e.columns),Object(u.a)(a))});case"REMOVE_COLUMN":return O({},e,{columns:e.datasets.filter(function(e){return e.id!==a})});case"ADD_ENTRIES":return O({},e,{entries:[].concat(Object(u.a)(e.entries),Object(u.a)(a))});case"REMOVE ENTRY":return O({},e,{entries:e.entries.filter(function(e){return e.id!==a})});case"CREATE_META_COLUMN_FROM_COL_ID":return O({},e,{metaColumns:[].concat(Object(u.a)(e.metaColumns),[{id:a.id,name:e.columns.find(function(e){return e.id===a.col_id}).name,description:e.columns.find(function(e){return e.id===a.col_id}).description,project_id:a.project_id,columns:[a.col_id]}])});case"REMOVE_MAPPINGS_FOR_METACOLUMN":return O({},e,{mappings:e.mappings.filter(function(e){return e.column_id!==a})});case"REMOVE_META_COLUMNS":return O({},e,{metaColumns:e.metaColumns.filter(function(e){return!a.includes(e.id)})});case"ADD_META_COLUMNS":return O({},e,{metaColumns:[].concat(Object(u.a)(e.metaColumns),Object(u.a)(a))});case"ADD_MAPPINGS":return O({},e,{mappings:[].concat(Object(u.a)(e.mappings),Object(u.a)(a))});case"REMOVE_MAPPING":return O({},e,{mappings:e.mappings.filter(function(e){return e.id!==a})});case"ADD_MAPPINGS":return O({},e,{mappings:[].concat(Object(u.a)(e.mappings),Object(u.a)(a))});case"ADD_MAPPING":return O({},e,{mappings:[].concat(Object(u.a)(e.mappings),[a])});case"ADD_PROJECT":return O({},e,{projects:[].concat(Object(u.a)(e.projects),[O({id:y()},a)])});case"REMOVE_PROJECT":return O({},e,{projects:e.projects.filter(function(e){return e.id!==a})});case"UPDATE_PROJECT":return O({},e,{projects:e.projects.map(function(e){return e.id==a.id?O({},e,{},a):e})});case"ADD ENTRY TO MAPPING":return O({},e,{mappings:e.mappings.map(function(e){return e.id===a.id?O({},e,{entries:[].concat(Object(u.a)(e.entries),[a.entry])}):e})});case"UPDATE_MAPPING":return O({},e,{mappings:e.mappings.map(function(e){return e.id===a.id?O({},e,{},a.mapping):e})});case"REMOVE_ENTRIES_FOR_COLUMN":return O({},e,{entries:e.entries.filter(function(e){return e.columnID===a})});case"REMOVE_META_COLUMN":return O({},e,{meta_columns:e.metaColumns.filter(function(e){return e.id!==a})});case"UPDATE_META_COLUMN":return O({},e,{meta_columns:e.metaColumns.map(function(e){return e.id===a.id?O({},e,{},a.meta_column):e})});case"SET_PERSISTING":return O({},e,{persisting:a});case"UPDATE_STORAGE_QUOTA":return O({},e,{storage_stats:a});default:return e}},A=function(){return Object(a.useContext)(v)},D=function(e){var t=A(),n=Object(l.a)(t,2),a=n[0],r=n[1],c=a.projects.find(function(t){return t.id===e}),o=a.datasets.filter(function(t){return t.project_id===e}),i=a.metaColumns.filter(function(t){return t.project_id===e}),s=i.map(function(e){return e.id}),m=i.reduce(function(e,t){return[].concat(Object(u.a)(e),Object(u.a)(t.columns))},[]),p=a.mappings.filter(function(e){return s.includes(e.column_id)}),d=a.columns.filter(function(e){return m.includes(e.id)}),f=d.map(function(e){return e.id}),E=a.entries.filter(function(e){return f.includes(e.column_id)});return{project:c,datasets:o,meta_columns:i,columns:d,mappings:p,deleteProject:function(){d.forEach(function(e){r({type:"DELETE_ENTRIES_FOR_COLUMN",payload:e.id}),r({type:"REMOVE_COLUMN",payload:e.id})}),p.forEach(function(e){r({type:"REMOVE_MAPPING",payload:e.id})}),i.forEach(function(e){r({type:"REMOVE_META_COLUMN",payload:e.id})}),o.forEach(function(e){r({type:"REMOVE_DATASET",payload:e.id})}),r({type:"REMOVE_PROJECT",payload:c.id})},entries:E}},S=function(e){var t=A(),n=Object(l.a)(t,2),a=n[0],r=n[1],c=a.columns.find(function(t){return t.id===e}),o=a.entries.filter(function(t){return t.column_id==e}),i=a.mappings.filter(function(t){return t.column_id===e}),s=o.map(function(e){return e.name});return{column:c,entries:o,mappings:i,embeddings:a.embeddings.filter(function(e){return s.includes(e.entry)}),dispatch:r}},P=function(e){var t=A(),n=Object(l.a)(t,2),a=n[0],r=n[1],c=a.metaColumns.find(function(t){return t.id===e});if(!c)return{meta_column:null,entries:[],mappings:[],embeggins:[],dispatch:r};var o=a.entries.filter(function(e){return c.columns.includes(e.column_id)}),i=Array.from(new Set(o.map(function(e){return e.name}))).map(function(e){var t=o.filter(function(t){return t.name===e}).reduce(function(e,t){return e+t.count},0);return{name:e,count:t}}),s=a.mappings.filter(function(e){return e.column_id===c.id}),u=o.map(function(e){return e.name}),m=a.embeddings.filter(function(e){return u.includes(e.entry)});return{meta_column:c,entries:i,mappings:s,embeddings:m,dispatch:r}},M=function(){var e=A(),t=Object(l.a)(e,2),n=t[0],a=(t[1],n.projects),r=n.datasets,c=n.columns;n.meta_columns;return a.reduce(function(e,t){var n=r.filter(function(e){return e.project_id===t.id}).map(function(e){return e.id}),a=c.filter(function(e){return n.includes(e.id)}),o=c.filter(function(e){return e.project_id==t.id});return[].concat(Object(u.a)(e),[{project:t,stats:{datasets:r.length,columns:a.length,meta_columns:o.length}}])},[])},w=function(){var e=A(),t=Object(l.a)(e,2),n=t[0],a=n.storage_stats,r=n.persisting;t[1];return console.log("storage stats",a),a?{persisting:r,quota:a.quota/1e6,usage:a.usage/1e6}:{}},T=function(e){var t=A(),n=Object(l.a)(t,2),a=n[0],r=(n[1],a.datasets.find(function(t){return t.id===e})),c=a.columns.filter(function(t){return t.dataset_id===e}),o=c.map(function(e){return e.id});return{dataset:r,columns:c,mappings:a.mappings.filter(function(e){return o.includes(e.columnID)})}};var k=n(70),R=n(13),x=n(11);function L(e){e.history,e.match;return r.a.createElement("div",{className:"sidenav"},r.a.createElement("div",{className:"logos"},r.a.createElement(i.b,{style:{display:"flex",alignItems:"center"},to:"/"},r.a.createElement("img",{src:"".concat("/Smooshr","/DataClinicLogo.png")})," ",r.a.createElement("span",{className:"data-clinic"},"Data Clinic")," "),r.a.createElement("span",{className:"project-name"},"smooshr (beta)")),r.a.createElement("div",{className:"spacer"}),r.a.createElement("div",{className:"top-menu"},r.a.createElement(i.b,{to:"/"},"Projects"),r.a.createElement(i.b,{to:"/about"},"About"),r.a.createElement("a",{target:"_blank",href:"https://airtable.com/shrMCZrvP7467LNG7"},"Feedback")))}function I(){return r.a.createElement("svg",{width:"116",height:"21",viewBox:"0 0 230 42",xmlns:"http://www.w3.org/2000/svg"}," ",r.a.createElement("title",null,"Two Sigma"),r.a.createElement("defs",null,r.a.createElement("path",{id:"a",d:"M19.436 21.668V1.025H0v20.643h19.435z"})),r.a.createElement("g",{fill:"none","fill-rule":"evenodd"},r.a.createElement("path",{fill:"#FFFFFF",d:"M59.06 13.464h-7.137v-3.155h17.811v3.155H62.6V30.95h-3.54zm14.01-3.155h3.745l4.747 15.66h.06l4.483-15.66h3.301l4.454 15.66h.059l4.777-15.66h3.716L95.895 30.95H92.09l-4.335-15.127h-.059L83.361 30.95h-3.804zm41.214-.355c5.986 0 10.527 4.158 10.527 10.556 0 6.55-4.541 10.794-10.527 10.794-5.985 0-10.558-4.245-10.558-10.794 0-6.398 4.573-10.556 10.558-10.556m0 18.285c3.892 0 6.93-2.89 6.93-7.729 0-4.658-3.007-7.518-6.93-7.518-3.922 0-6.93 2.86-6.93 7.518 0 4.839 3.038 7.73 6.93 7.73m40.846-17.931h3.539V30.95h-3.54V19.41zm18.744-.355c2.832 0 5.222.885 7.313 2.33 0 0-2.026 2.374-2.128 2.311-1.56-1-3.21-1.574-5.096-1.574-4.247 0-7.048 3.068-7.048 7.433 0 4.746 2.624 7.785 7.048 7.785 1.534 0 3.067-.385 4.13-1.003v-4.897h-5.19v-2.623h8.462v9.347c-2.007 1.416-4.63 2.24-7.49 2.24-6.46 0-10.587-4.363-10.587-10.85 0-6.075 4.187-10.499 10.586-10.499m12.506.355h3.57l6.812 9.701 6.811-9.701h3.541V30.95h-3.421V15.558l-6.962 9.73-6.958-9.73V30.95h-3.392z"}),r.a.createElement("g",{transform:"translate(210.418 9.283)"},r.a.createElement("path",{d:"M7.639 1.025h4.158l7.64 20.643H15.63l-1.561-4.454H5.368l-1.533 4.454H0L7.639 1.025zM6.34 14.354h6.725L9.734 4.74h-.06L6.34 14.354z",fill:"#FFFFFF"})),r.a.createElement("path",{d:"M136.826 26.498c1.861 1.007 3.618 1.68 5.887 1.68 2.715 0 4.069-1.18 4.069-2.83 0-4.66-11.616-1.594-11.616-9.466 0-3.303 2.74-5.928 7.37-5.928 2.714 0 5.443.653 7.579 1.902l-2.314 2.361c-1.68-.72-3.11-1.137-5.146-1.137-2.389 0-3.806 1.21-3.806 2.744 0 4.63 11.62 1.473 11.62 9.494 0 3.393-2.567 5.985-7.756 5.985-3.035 0-6.33-1.076-8.273-2.419l2.386-2.386z",fill:"#FFFFFF"}),r.a.createElement("path",{fill:"#009AA6",d:"M20.625 0L0 20.63l20.625 20.628 20.63-20.628z"}),r.a.createElement("path",{d:"M9.748 26.478c-.16-6.605 7.789-5.746 7.789-9.13 0-1.1-.863-2.041-2.784-2.041-1.401 0-2.743.701-3.724 1.602l-1.46-1.463c1.259-1.18 3.223-2.14 5.284-2.14 3.304 0 4.986 1.842 4.986 4.003 0 4.986-7.728 4.104-7.728 8.27h7.607v1.98h-9.95l-.02-1.081zm15.937-.5c-1.521 0-2.423-.98-2.423-2.862 0-2.404 1.602-4.566 3.525-4.566 1.5 0 2.402.981 2.402 2.883 0 2.401-1.582 4.545-3.504 4.545zm9.713-9.25h-8.444v.003c-3.437.005-6.033 2.745-6.033 6.403 0 2.905 1.881 4.666 4.544 4.666 3.464 0 6.067-2.743 6.067-6.386 0-1.182-.313-2.173-.856-2.935h2.947l1.775-1.75z",fill:"#FFF"})))}function U(){return r.a.createElement("footer",null,r.a.createElement(I,null),r.a.createElement("p",{className:"copyright"},"\xa9 2019 Two Sigma Investments, LP. All rights reserved."),r.a.createElement("p",{className:"social"},r.a.createElement("a",{href:"https://twitter.com/tsdataclinic?lang=en",target:"_blank"},r.a.createElement(x.a,{icon:k.c})),r.a.createElement("a",{href:"https://medium.com/dataclinic",target:"_blank"},r.a.createElement(x.a,{icon:k.b})),r.a.createElement("a",{href:"https://github.com/tsdataclinic",target:"blank"},r.a.createElement(x.a,{icon:k.a}))))}var F=n(36),G=n.n(F),V=n(56),B=n(192),z=n.n(B),q=n(72),J=n(57),W=n.n(J);var H=n(193),Y=n.n(H),Z=n(79);var K=function(e,t,n,a,r,c){$(e,t,n,a,r);var o,l=W()(e.name)+".json",i=W()(e.name)+"csv",s=$(e,t,n,a,r,c),u=(o=i,"\nimport pandas as pd \nimport json\nimport sys\n\nwith open('".concat(l,"', 'r') as f:\n    project = json.load(f)\n    datasets = project['datasets']\n\n    all_data = pd.DataFrame()\n\nfor dataset in datasets:\n    dataset_type = dataset['type']\n    dataset_name = dataset['ref']['path']\n    if(dataset_type=='file'):\n        file_path = 'put_your_datasets_in_here/{}'.format(dataset_name)\n        try:\n           print('Raeding {}'.format(dataset_name))\n           data = pd.read_csv(file_path)\n        except:\n           print(\"Place the file {} in the folder put_your_datasets_in_here\".format(file_path))\n           sys.exit()\n    elif(dataset_type['type'] == 'url'):\n        data = pd.read_csv(data['ref']['url'])\n    elif(dataset_Type['type'] == 'open_data'):\n        data = pd.read_csv(data['ref']['url'])\n        \n    print(\"Renaming columns\")\n    column_renames  = dataset['column_renames']\n    data = data.rename(columns=column_renames)\n\n    all_data = all_data.append(data, ignore_index=True)\n\nprint('Applying column mappings')\nfor column,mapping in project['mappings'].items():\n    map_dict = {}\n    for key, values in mapping.items():\n        for value in values:\n            map_dict[value] = key \n            \n    all_data[column] = all_data[column].map(lambda x: map_dict[x] if x in mapping else 'unknown')\n\nprint('Writing out results')\nall_data.to_csv('results/").concat(o,"')\nprint('Datasets have been smooshed')\n    ")),m=new Y.a,p=m.folder(e.name);m.folder("".concat(e.name,"/put_your_datasets_in_here")),m.folder("".concat(e.name,"/results")),p.file(l,JSON.stringify(s)),p.file("process.py",u),m.generateAsync({type:"blob"}).then(function(t){Object(q.saveAs)(t,W()(e.name)+"zip")})},Q=function(e,t,n,a,r,c,o){var l={project:e,datasets:t,meta_columns:n,columns:a,mappings:r,entries:c},i="".concat(e.name,".json"),s=new Blob([JSON.stringify(l)],{type:"text/plain;charset=utf-8"});Object(q.saveAs)(s,i)},$=function(e,t,n,a,r,c){var o={name:e.name,description:e.description,id:e.id},l=function(e){var t={};return n.forEach(function(n){n.columns.map(function(e){return a.find(function(t){return t.id===e})}).filter(function(t){return t.dataset_id===e.id}).forEach(function(e){t[e.name]=n.name})}),t},i=t.map(function(e){return{type:e.file.type,ref:e.file.ref,rows:e.rows,column_renames:l(e)}}),s=(W()(e.name),{});return n.forEach(function(e){var t=r.filter(function(t){return t.column_id===e.id});s[e.name]={},t.forEach(function(t){s[e.name][t.name]=t.entries})}),{project:o,datasets:i,mappings:s,settings:c||{}}};function X(e){var t=e.total,n=e.value,a=e.style;return r.a.createElement("div",{className:"progress-bar",style:a},r.a.createElement("div",{className:"progress-bar-outer"},r.a.createElement("div",{className:"progress-bar-inner",style:{width:"".concat(100*n/t,"%")}})),r.a.createElement("p",{className:"progress-bar-pc"},n?(100*n/t).toPrecision(3):0," %"))}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function te(e){var t=e.file,n=e.onAddDataset,c=Object(a.useState)([]),o=Object(l.a)(c,2),i=o[0],m=o[1],p=Object(a.useState)([]),d=Object(l.a)(p,2),f=d[0],E=d[1],g=Object(a.useState)([]),h=Object(l.a)(g,2),b=h[0],O=h[1],y=Object(a.useState)([]),v=Object(l.a)(y,2),j=v[0],_=v[1],C=Object(a.useState)({}),N=Object(l.a)(C,2),D=N[0],S=N[1],P=Object(a.useState)("loading"),M=Object(l.a)(P,2),w=M[0],T=M[1],k=A(),R=Object(l.a)(k,2),x=(R[0],R[1],Object(a.useMemo)(function(){return i.reduce(function(e,t){var n=b.filter(function(e){return e.column_id===t.id});return e[t.id]={entries:n.slice(0,5).map(function(e){return e.name}),extra:n.length-5},e},{})},[b,i]));return Object(a.useEffect)(function(){(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:500;return new Promise(function(c,o){var i=0,s={},u=[],m=[],p={},d=e.ref,f=d.size;"file"!==e.type&&(d=d.split("?")[0],d="".concat("https://smooshr.stuartlynn.me","/proxy?url=").concat(d)),z.a.parse(d,{worker:!0,header:!0,download:"file"!==e.type,step:function(e){i<a&&u.push(e.data),0==i&&e.meta.fields.forEach(function(e){s[e]={},p[e]=0}),(i+=1)%n==0&&t&&t({rows_read:i,bytes_read:e.meta.cursor,total_size:f}),e.meta.fields.forEach(function(t){var n=e.data[t];n!=t&&(n in s[t]?s[t][n]+=1:p[t]<r?(s[t][n]=1,p[t]+=1):m.includes(t)||m.push(t))})},error:function(e){console.log("something bad happened")},complete:function(){var t=[],n=[],a=Z();Object.keys(s).forEach(function(e){var r=Z();t.push({unique:Object.keys(s[e]).length,id:r,name:e,key:e,dataset_id:a,type:"text",exceded:m.includes(e)}),Object.entries(s[e]).forEach(function(e){var t=Object(l.a)(e,2),a=t[0],c=t[1];return n.push({column_id:r,name:a,count:c})})}),c({dataset:{id:a,name:"url"===e.type?e.ref.split("?")[0]:e.ref.name,file:e,row_count:i,sample:u},columns:t,entries:n})}})})})(t,function(e){return S(e)}).then(function(e){T("selecting"),E(e.dataset),m(e.columns),O(e.entries)})},[t]),r.a.createElement("div",{className:"fileSnapshot"},r.a.createElement("div",{className:"file-snapshot-header"},r.a.createElement("h3",null,"url"===t.type?t.ref:t.ref.name),"loading"==w&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Loading, parsed ",D.rows_read?D.rows_read.toLocaleString():0," rows"),r.a.createElement(X,{total:D.total_size?D.total_size:0,value:D.bytes_read,style:{width:"500px"}})),"selecting"==w&&r.a.createElement("p",null,"Has a total of ",f.row_count," rows and ",i.length," ","columns. Select the columns you want to work with")),"selecting"==w&&r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"column-summary-list "},i.map(function(e){return r.a.createElement("li",{className:"column-preview-card card",key:e.id},r.a.createElement("div",null,r.a.createElement("div",{class:"summary_list_header"},r.a.createElement("h3",null,e.name," ",r.a.createElement("span",null,"".concat(e.exceded?">":""," ").concat(e.unique))),r.a.createElement("input",{type:"checkbox",checked:j.includes(e.id),onChange:function(){return t=e.id,void(j.includes(t)?_(j.filter(function(e){return e!==t})):_([].concat(Object(u.a)(j),[t])));var t}})),r.a.createElement("p",null,x[e.id].entries.join(", ")+" and ".concat(x[e.id].extra," more"))))})),r.a.createElement("div",{className:"column-summary-buttons"},r.a.createElement("button",{onClick:function(){var e=i.map(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{focusCol:j.includes(e.id)})}),t=b.filter(function(e){return j.includes(e.column_id)});n(f,e,t),T("saved")}},"Load"),r.a.createElement("button",{onClick:function(){T("skipping")}},"Skip"))))}function ne(e){var t=e.options,n=e.selected,a=e.onSelected;return console.log("SELECTED ",n),r.a.createElement("div",{className:"Tabs"},t.map(function(e){return r.a.createElement("p",{className:"Tab ".concat(n===e?"selected":""," "),key:e,onClick:function(){return a(e)}},e)}))}function ae(e){var t=e.value,n=e.onChange,a=e.prompt,c=e.style;return r.a.createElement("div",{className:"SearchBarContainer",style:c},r.a.createElement(x.a,{className:"searchIcon",icon:R.l}),r.a.createElement("input",{type:"text",className:"SearchBar",onChange:function(e){return n(e.target.value)},placeholder:a,value:t}),r.a.createElement(x.a,{className:"clearIcon",onClick:function(){return n("")},icon:R.n}))}function re(e){var t=e.onDataset,n=Object(a.useState)(""),c=Object(l.a)(n,2),o=c[0],i=c[1],s=Object(a.useState)([]),u=Object(l.a)(s,2),m=u[0],p=u[1],d="data.cityofnewyork.us";return Object(a.useEffect)(function(){fetch("".concat("http://api.us.socrata.com/api/catalog/v1?","domains=").concat(d,"&search_context=").concat(d,"&limit=20&only=datasets&q=").concat(o)).then(function(e){return e.json()}).then(function(e){console.log(e.results),p(e.results)}).catch(function(e){return console.log(e)})},[o]),r.a.createElement("div",{className:"open-data-search"},r.a.createElement(ae,{style:{marginBottom:"30px"},text:o,onChange:i}),m.map(function(e){return r.a.createElement("p",null,e.resource.name," ",r.a.createElement("span",{className:"open-data-result-controls"}," ",r.a.createElement("a",{href:e.permalink,target:"_blank"},r.a.createElement(x.a,{icon:R.f}))," ",r.a.createElement(x.a,{onClick:function(){return function(e){t({type:"opendata",ref:"https://data.cityofnewyork.us/api/views/".concat(e.resource.id,"/rows.csv?accessType=DOWNLOAD")})}(e)},icon:R.d}))," ")}))}function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function oe(e){var t=Object(a.useState)(null),n=Object(l.a)(t,2),c=n[0],o=n[1],i=Object(a.useState)(null),u=Object(l.a)(i,2),m=u[0],p=u[1],d=Object(a.useState)(null),f=Object(l.a)(d,2),E=f[0],g=f[1],h=Object(a.useState)([]),b=Object(l.a)(h,2),O=b[0],y=b[1],v=(e.onClose,Object(a.useState)("file")),j=Object(l.a)(v,2),_=j[0],C=j[1],N=function(){o([{type:"url",ref:E}])},A=function(e){o([e])},D=Object(a.useCallback)(function(e){e.every(function(e){return e.name.split(".").includes("csv")})?(o(e.map(function(e){return{type:"file",ref:e}})),y(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},O,Object(s.a)({},e[0].name,{}))),p(null)):p("Some files are not CSVs, We only support CSVs for now")}),S=Object(V.a)({onDrop:D}),P=S.getRootProps,M=S.getInputProps,w=S.isDragActive;return r.a.createElement("div",{classname:"file-uploader"},r.a.createElement(ne,{options:["file","url","open data portal"],selected:_,onSelected:function(e){return C(e)}}),c?r.a.createElement("div",null,c.map(function(t){return r.a.createElement(te,{file:t,onAddDataset:e.onAddDataset})})):r.a.createElement("div",{className:"content"},function(){switch(_){case"file":return r.a.createElement("div",P(),r.a.createElement("div",{className:"file-tab",style:{cursor:"p"}},r.a.createElement(x.a,{icon:R.g}),r.a.createElement("input",M({accept:["text/csv","application/vnd.ms-excel"]})),w?r.a.createElement("p",null,"Drop the files here ... "):r.a.createElement("p",null,"Drag 'n' drop files here or click to load dataset")),m&&r.a.createElement("p",null,m));case"url":return r.a.createElement("div",{className:"url-tab"},r.a.createElement(x.a,{icon:R.d}),r.a.createElement("div",null,r.a.createElement("input",{placeholder:"dataseturl",value:E,onChange:function(e){return g(e.target.value)}}),r.a.createElement("button",{disabled:!E,onClick:N},"Submit")));case"open data portal":return r.a.createElement(re,{onDataset:A})}}()))}function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}ae.defaultProps={style:{}};var se=n(79);function ue(e){var t=e.match,n=e.history,c=t.params.projectID,o=function(){return n.goBack()},i=A(),s=Object(l.a)(i,2),u=(s[0],s[1]),m=Object(a.useState)("file"),p=Object(l.a)(m,2);p[0],p[1];return r.a.createElement(G.a,{style:{content:{height:"60%",width:"80%",transform:"translate(10%,15%)"},overlay:{backgroundColor:"rgba(0, 0, 0, 0.75)"}},isOpen:!0,onRequestClose:o},r.a.createElement(oe,{onAddDataset:function(e,t,n){var a=t.filter(function(e){return e.focusCol}).map(function(e){return{columns:[e.id],name:e.name,description:"",project_id:c,id:se()}});u({type:"ADD_DATASETS",payload:[ie({},e,{project_id:c})]}),u({type:"ADD_COLUMNS",payload:t}),u({type:"ADD_ENTRIES",payload:n}),u({type:"ADD_META_COLUMNS",payload:a}),o()},onClose:o}))}function me(e){e.match;var t=e.history,n=function(){return t.goBack()},c=A(),o=Object(l.a)(c,2),i=(o[0],o[1]),s=Object(a.useState)(),u=Object(l.a)(s,2),m=u[0],p=u[1],d=Object(a.useState)(),f=Object(l.a)(d,2),E=f[0],g=f[1];return r.a.createElement(G.a,{style:{content:{height:"35%",width:"50%",transform:"translate(40%,40%)"},overlay:{backgroundColor:"rgba(0, 0, 0, 0.75)"}},isOpen:!0,onRequestClose:n},r.a.createElement("div",{className:"new-project-modal"},r.a.createElement("h1",null,"New Project"),r.a.createElement("p",null,"Project Name"),r.a.createElement("input",{value:m,onChange:function(e){return p(e.target.value)},placeholder:"name"}),r.a.createElement("p",null,"Description"),r.a.createElement("textarea",{value:E,onChange:function(e){return g(e.target.value)},placeholder:"description"}),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{onClick:function(){i({type:"ADD_PROJECT",payload:{name:m,description:E}}),n()}},"Create"),r.a.createElement("button",{className:"cancel-button",onClick:n},"Cancel"))))}function pe(e){e.match;var t=e.history,n=A(),c=Object(l.a)(n,2),o=(c[0],c[1]),i=Object(a.useState)(null),s=Object(l.a)(i,2),u=s[0],m=(s[1],Object(a.useState)()),p=Object(l.a)(m,2),d=(p[0],p[1],Object(a.useState)()),f=Object(l.a)(d,2),E=(f[0],f[1],Object(a.useState)(null)),g=Object(l.a)(E,2),h=g[0],b=g[1],O=Object(a.useCallback)(function(e){var t=e[0],n=new FileReader;n.readAsText(t),n.onload=function(e){b(JSON.parse(n.result))}}),y=Object(V.a)({onDrop:O}),v=y.getRootProps,j=y.getInputProps,_=y.isDragActive;return r.a.createElement(G.a,{isOpen:!0,onRequestClose:function(){return t.goBack()},style:{content:{height:"50%",width:"60%",transform:"translate(25%,15%)"},overlay:{backgroundColor:"rgba(0, 0, 0, 0.75)"}}},r.a.createElement("div",{className:"load-project-modal"},r.a.createElement("h1",null,"Load Project"),r.a.createElement("div",{className:"content"},h?r.a.createElement("div",null,r.a.createElement("h1",null,h.project.name),r.a.createElement("section",null,r.a.createElement("header",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},r.a.createElement(x.a,{icon:R.c,style:{marginRight:"20px"}}),r.a.createElement("h2",null,"Datasets")),r.a.createElement("p",null,h.project.description),h.datasets.map(function(e){return r.a.createElement("p",null,e.name)})),r.a.createElement("section",null,r.a.createElement("header",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},r.a.createElement(x.a,{icon:R.b,style:{marginRight:"20px"}}),r.a.createElement("h2",null,"Coumns")),h.meta_columns.map(function(e){return r.a.createElement("p",null,e.name)})),r.a.createElement("button",{onClick:function(){!function(e,t){var n=e.project,a=e.datasets,r=e.entries,c=e.columns,o=e.mappings,l=e.meta_columns;e.settings,t({type:"ADD_OR_REPLACE_PROJECT",payload:n}),a.forEach(function(e){t({type:"ADD_OR_REPLACE_DATASET",payload:e})}),c.forEach(function(e){t({type:"ADD_OR_REPLACE_COLUMN",payload:e})}),o.forEach(function(e){t({type:"ADD_OR_REPLACE_MAPPING",payload:e})}),l.forEach(function(e){t({type:"ADD_OR_REPLACE_METACOLUMN",payload:e})}),r.forEach(function(e){console.log("entry ",e),t({type:"ADD_OR_REPLACE_ENTRY",payload:e})})}(h,o),t.goBack()}},"Load")):r.a.createElement("div",v(),r.a.createElement("div",{className:"file-tab",style:{cursor:"p"}},r.a.createElement(x.a,{icon:R.g}),r.a.createElement("input",j({accept:["text/csv","application/vnd.ms-excel"]})),_?r.a.createElement("p",null,"Drop the files here ... "):r.a.createElement("p",null,"Drag 'n' drop project file here or click to load project")),u&&r.a.createElement("p",null,u)))))}var de=n(48);function fe(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)(function(){var e=sessionStorage.redirect;if(delete sessionStorage.redirect,console.log("Public URL ","/Smooshr"),console.log("redirect ",n),e&&e!=window.location.href){var t=e;t="/"+t.split("/").slice(4).join("/"),console.log("REDIRECTING TO ",t),c(t)}},[]),n?r.a.createElement(de.a,{to:n}):r.a.createElement(r.a.Fragment,null)}var Ee=n(194),ge=n.n(Ee);function he(e){var t=e.file,n=e.columns,c=(e.mappings,Object(a.useState)(!0)),o=Object(l.a)(c,2),i=o[0],s=o[1],u=Object(a.useState)(!1),m=Object(l.a)(u,2),p=(m[0],m[1],Object(a.useState)("pending")),d=Object(l.a)(p,2),f=d[0],E=d[1];return r.a.createElement("div",{className:"ApplyMapping"},"pending"===f&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{id:t.name},t.name),r.a.createElement("div",{className:"options"},r.a.createElement("p",null,"Applying mappings to ",n.length," columns"),"Add Columns:"," ",r.a.createElement("input",{type:"checkbox",checked:i,onChange:function(e){return s(e.target.checked)}}),"Treat Unmapped as Unknown: ",r.a.createElement("input",{type:"checkbox"}),r.a.createElement("button",{onClick:function(){E("running");var e=ge.a.createWriteStream("processed.txt",{size:22});new Response("StreamSaver is awesome").body.pipeTo(e).then(function(){console.log("SAVED")},function(){console.log("ERROR")})}},"Apply Mapping"))),"running"===f&&r.a.createElement("h2",null,"Running"),"done"===f&&r.a.createElement("h2",null,"Done"))}function be(e){var t=e.match,n=e.history,c=Object(a.useState)(null),o=Object(l.a)(c,2),i=o[0],s=o[1],u=Object(a.useState)(null),m=Object(l.a)(u,2),p=m[0],d=m[1],f=t.params.datasetID,E=T(f),g=(E.dataset,E.columns),h=E.mappings,b=Object(a.useCallback)(function(e){e.every(function(e){return e.name.split(".").includes("csv")})?s(e):d("Smoosher currently only supports CSV's please just upload those!")}),O=Object(V.a)({onDrop:b}),y=O.getRootProps,v=O.getInputProps,j=O.isDragActive;return r.a.createElement(G.a,{isOpen:!0,onRequestClose:function(){console.log("PREVIOUS STATE"),n.goBack()}},p&&r.a.createElement("h1",null,p),i?r.a.createElement("div",null,i.map(function(e){return r.a.createElement(he,{file:e,columns:g,mappings:h})})):r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Select files to apply mapping to"),r.a.createElement("div",{className:"fileUploader"},r.a.createElement("div",y(),r.a.createElement("input",v({accept:["text/csv","application/vnd.ms-excel"]})),j?r.a.createElement("p",null,"Drop the files here ... "):r.a.createElement("p",null,"Drag 'n' drop files to apply mapping")))))}function Oe(e){var t=e.match,n=e.history,c=function(){return n.goBack()},o=A(),i=Object(l.a)(o,2),s=(i[0],i[1],t.params.projectID),u=D(s),m=u.project,p=u.datasets,d=u.meta_columns,f=u.columns,E=u.mappings,g=Object(a.useState)(!1),h=Object(l.a)(g,2),b=h[0],O=(h[1],Object(a.useState)(!1)),y=Object(l.a)(O,2),v=y[0],j=(y[1],Object(a.useState)(!0)),_=Object(l.a)(j,2),C=_[0],N=(_[1],Object(a.useState)("unknown")),S=Object(l.a)(N,2),P=S[0];S[1];return r.a.createElement(G.a,{style:{content:{height:"35%",transform:"translate(0,40%)"},overlay:{backgroundColor:"rgba(0, 0, 0, 0.75)"}},isOpen:!0,onRequestClose:c},r.a.createElement("div",{className:"code-export-modal"},m&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("h1",null,m.name),r.a.createElement("p",null,"Export Code")),r.a.createElement("div",{className:"export_instructions"},r.a.createElement("p",null,"Click export to download a zip file with everything you need to apply your mapping."),r.a.createElement("p",null,"The code will do the following:"),r.a.createElement("ul",null,r.a.createElement("li",null,'Load the files you worked on from the "put_your_files_in_here" filder'),r.a.createElement("li",null,"Combine and rename columns from each dataset as you indicated"),r.a.createElement("li",null,"Apply the new taxonomies you produced to those columns"),r.a.createElement("li",null,'Export the results to the "results" folder')),r.a.createElement("p",null,'The script that does all this is called "process.py" you can tweak it to suit your needs')),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{onClick:function(){K(m,p,d,f,E,{changeNonMapped:b,createNewColumns:v,combineDatasets:C,valueForNonMapped:P})}},"Export"),r.a.createElement("button",{onClick:c},"Cancel")))))}var ye=n(84),ve=n(115);n(361);function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var _e={},Ce=function(e,t){var n=[];return e.forEach(function(a){t.forEach(function(t){var r=[a,t.name].join("_");if(!e.includes(t))if(_e[r])n.push({suggestion:t.name,score:_e[r]});else{var c=ye.get(a,t.name);_e[r]=c,n.push({suggestion:t.name,score:c})}})}),n.sort(function(e,t){return e.score>t.score?1:-1}).slice(0,5)},Ne=function(e,t){var n=e.map(function(e){return 300===e.embed.length?e.embed:Object(u.a)(Array(300)).map(function(e){return 0})}),a=Object(ve.a)(n,t);return a=e.map(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{cluster:a.clusters[t]})})},Ae=n(197);function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Pe(e){var t=e.match,n=e.history,c=t.params.columnID,o=Object(a.useState)([]),i=Object(l.a)(o,2),s=(i[0],i[1],Object(a.useState)([])),m=Object(l.a)(s,2),p=m[0],d=m[1],E=Object(a.useState)(10),g=Object(l.a)(E,2),h=g[0],b=g[1],O=S(c),y=(O.column,O.entries);return Object(a.useEffect)(function(){y&&y.length},[y]),r.a.createElement(G.a,{isOpen:!0,onRequestClose:function(){return n.goBack()}},r.a.createElement("h1",null,"Detect categories"),r.a.createElement("span",null,"No clusters: ",h),r.a.createElement(Ae.Range,{style:{width:"200px"},max:20,min:2,step:1,values:[h],onChange:function(e){return b(e[0])},renderTrack:function(e){var t=e.props,n=e.children;return r.a.createElement("div",Object.assign({},t,{style:Se({},t.style,{height:"6px",width:"100%",backgroundColor:"#ccc"})}),n)},renderThumb:function(e){var t=e.props;return r.a.createElement("div",Object.assign({},t,{style:Se({},t.style,{height:"42px",width:"42px",backgroundColor:"#999"})}))}}),p.length>0&&Object(u.a)(Array(h)).map(function(e,t){return r.a.createElement("div",{key:t},r.a.createElement("h3",null,"Cluster ",t+1),r.a.createElement("p",null," ",p.filter(function(e){return e.cluster===t}).map(function(e){return e.entry}).join(", ")))}),r.a.createElement("button",{onClick:function(){f(y).then(function(e){var t=Ne(e,h);d(t)})}},"Calc categories"))}var Me=n(198),we=n.n(Me);function Te(e){var t=e.data,n=Object.keys(t[0]).map(function(e){return{key:e,name:e}}),c=Object(a.useState)(t),o=Object(l.a)(c,2),i=o[0],s=o[1];return 0==t.length?r.a.createElement("h1",null," No data to show"):r.a.createElement(we.a,{columns:n,rowGetter:function(e){return i[e]},rowsCount:t.length,onGridSort:function(e,n){return s(function(e,t,n){return function(a){return"NONE"===n?e:Object(u.a)(a).sort(function(e,a){return"ASC"===n?e[t]>a[t]?1:-1:"DESC"===n?e[t]<a[t]?1:-1:void 0})}}(t,e,n))}})}function ke(e){var t=e.match.params.datasetID,n=A(),a=Object(l.a)(n,2),c=a[0],o=c.datasets,i=c.columns,s=(c.mappings,a[1],o.find(function(e){return e.id==t})),u=i.filter(function(e){return e.dataset_id===t});return s?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"datatable full_card"},r.a.createElement(Te,{data:s.sample,columns:u}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-around",marginTop:"20px"}}))):r.a.createElement("h2",null,"Could not find dataset")}function Re(e){var t=e.entry,n=e.selected,a=void 0!==n&&n,c=e.onToggleSelect;return r.a.createElement("div",{className:"EntryCard card ".concat(a?"selected":""),onClick:function(){return c(t)}},r.a.createElement("h3",null,t.name),r.a.createElement("p",null,t.count," occurrences"))}function xe(e){var t=e.onChange,n=Object(a.useState)(!1),c=Object(l.a)(n,2),o=c[0],i=c[1],s=Object(a.useState)("Alphabetically"),u=Object(l.a)(s,2),m=u[0],p=u[1];return r.a.createElement("div",{className:"OrderBy"},r.a.createElement("p",null,"Order By: "),r.a.createElement("ul",null,r.a.createElement("li",{onClick:function(){i(!0)}},m," ",r.a.createElement(x.a,{icon:R.m})," "),["Alphabetically","Occurances"].filter(function(e){return e!=m&&o}).map(function(e){return r.a.createElement("li",{onClick:function(){return n=e,i(!1),p(n),void(t&&t(n));var n}},e)})))}function Le(e){var t=e.entry,n=e.onRemove;return r.a.createElement("span",{className:"entry-pill"},r.a.createElement("span",null,t),r.a.createElement(x.a,{icon:R.n,onClick:function(){return n(t)}}))}function Ie(e){var t=e.selection,n=e.onRemoveSelection,a=e.onClearAll;return r.a.createElement("div",{className:"selected-entry-list"},0==t.length?r.a.createElement("span",null,"Click on entries to select them"):r.a.createElement("span",null,"Selections (",t.length,"):"),r.a.createElement("ul",null,t.reverse().map(function(e){return r.a.createElement("li",null,r.a.createElement(Le,{onRemove:n,entry:e})," ")})),t.length>0&&r.a.createElement("a",{className:"clear-all",onClick:a},"Clear All"))}function Ue(e){var t=e.entries,n=e.style,c=e.onToggleSelection,o=e.onClearSelection,i=e.selection,s=Object(a.useState)("Alphabetically"),m=Object(l.a)(s,2),p=m[0],d=m[1],f=function(e){c&&c(e)},E={Alphabetically:"name",Occurances:"count"}[p],g=t.sort(function(e,t){return e[E]>t[E]?1:-1});return"count"===E&&g.reverse(),r.a.createElement("div",{style:n,className:"EntryTable"},r.a.createElement("div",{className:"EntryTableFilters"},r.a.createElement(Ie,{selection:i,onRemoveSelection:f,onClearAll:o}),r.a.createElement(xe,{onChange:function(e){return d(e)}})),r.a.createElement("div",{className:"EntriesTableEntries"},g.length>0?g.map(function(e){return r.a.createElement(Re,{key:e.name,entry:e,selected:i.includes(e.name),onToggleSelect:f})}):r.a.createElement("div",{className:"all-done"},r.a.createElement("h1",null,"You really smooshed that crap out of that column."),r.a.createElement("h1",null,Object(u.a)(Array(5)).map(function(){return r.a.createElement(x.a,{icon:R.i})})))))}function Fe(e){var t=e.text,n=e.onUpdate,c=Object(a.useState)(t),o=Object(l.a)(c,2),i=o[0],s=o[1],u=Object(a.useState)(!1),m=Object(l.a)(u,2),p=m[0],d=m[1];return Object(a.useEffect)(function(){s(t)},[t]),p?r.a.createElement("input",{onChange:function(e){return s(e.target.value)},onBlur:function(){d(!1),n(i)},value:i}):r.a.createElement("h3",null,i," ",r.a.createElement(x.a,{onClick:function(){return d(!0)},icon:R.e}))}function Ge(e){var t=e.mapping,n=e.onRemoveEntryFromMapping,c=e.onRenameMapping,o=e.onClearMapping,i=e.onDeleteMapping,s=e.onAddSuggestionToMapping,u=e.onAddNegativeExampleToMapping,m=e.suggestions,p=e.style,d=Object(a.useState)("text"),f=Object(l.a)(d,2),E=f[0],g=f[1],h=m[E];return r.a.createElement("div",{className:"MappingFocus",style:p},r.a.createElement(Fe,{text:t.name,onUpdate:function(e){c&&c(t,e)}}),r.a.createElement("div",{className:"IncludeList"},r.a.createElement("h4",null,"Includes"),r.a.createElement("ul",null,t.entries.map(function(e){return r.a.createElement("li",null,e," ",r.a.createElement("button",{onClick:function(){return function(e){n&&n(e,t)}(e)},className:"SmallButton RoundButton"},r.a.createElement(x.a,{icon:R.n})," "))}))),r.a.createElement("div",{className:"KeywordMatch"},r.a.createElement("h4",null,"Suggestions by:"," ",r.a.createElement("span",{style:"text"==E?{fontWeight:"bold"}:{fontWeight:"lighter"},onClick:function(){return g("text")}},"text")," ","/"," ",r.a.createElement("span",{style:"meaning"==E?{fontWeight:"bold"}:{fontWeight:"lighter"},onClick:function(){return g("meaning")}},"meaning")),r.a.createElement("ul",null,h.map(function(e){return r.a.createElement("li",null,e.suggestion," ",r.a.createElement("div",{className:"SuggestionActionButtons"},r.a.createElement("button",{className:"SmallButton RoundButton",onClick:function(){return function(e){s&&s(e.suggestion)}(e)}},r.a.createElement(x.a,{icon:R.a})),r.a.createElement("button",{className:"SmallButton RoundButton",onClick:function(){return function(e){u&&u(e.suggestion)}(e)}},r.a.createElement(x.a,{icon:R.n}))))}))),r.a.createElement("div",{className:"ActionButtons"},r.a.createElement("button",{onClick:function(e){o&&o(t)},className:"MidButton"},"Clear Mapping"),r.a.createElement("button",{onClick:function(e){i&&i(t)},className:"MidButton"},"Delete Mapping")))}function Ve(e){var t=e.mappings,n=void 0===t?[]:t,a=e.selected,c=e.onMappingSelected,o=e.style;e.mapping;return r.a.createElement("div",{class:"MappingsMenu",style:o},r.a.createElement("h3",null,"Merged Groups ",r.a.createElement("span",{class:"Pill"},n.length)," "),r.a.createElement("ul",null,n.map(function(e){return r.a.createElement("li",{className:a&&e.name==a.name?"selected":"",onClick:function(){return function(e){c&&c(e)}(e)}},e.name)})))}function Be(e){var t=e.mappings,n=e.selection,a=e.onMappingSelected,c=e.onRenameMapping,o=e.onRemoveEntryFromMapping,l=e.onDeleteMapping,i=e.onClearMapping,s=e.onAddEntryToMapping,u=e.onAddSuggestionToMapping,m=e.onAddNegativeExampleToMapping,p=e.suggestions,d=e.style;return r.a.createElement("div",{className:"MappingsArea",style:d},r.a.createElement(Ve,{mappings:t,selected:n,onMappingSelected:a}),n&&r.a.createElement(Ge,{mapping:n,onRemoveEntryFromMapping:o,onRenameMapping:c,onDeleteMapping:l,onClearMapping:i,onAddEntryToMapping:s,onAddSuggestionToMapping:u,suggestions:p,onAddNegativeExampleToMapping:m}))}Te.defaultProps={data:[],columns:[]},Ie.defaultProps={selection:[]},Ue.defaultProps={style:{}},Ge.defaultProps={style:{},meaningSuggestions:[],textSuggestions:[]},Ve.defaultProps={mappings:[],style:{}},Be.defaultProps={style:{}};var ze=n(199),qe=n.n(ze);function Je(e){var t=e.match,n=Object(a.useState)(null),c=Object(l.a)(n,2),o=c[0],i=c[1],s=Object(a.useState)(null),m=Object(l.a)(s,2),d=m[0],E=m[1],h=Object(a.useState)([]),b=Object(l.a)(h,2),O=b[0],y=b[1],v=t.params.columnID,j=P(v),_=j.entries,C=j.mappings,N=j.embeddings,D=j.dispatch,S=C.find(function(e){return e.id==d});Object(a.useEffect)(function(){_&&function(e,t){f(e).then(function(e){t({type:"ADD_EMBEDINGS",payload:e})})}(_,D)},[JSON.stringify(_)]);var M=_.filter(function(e){return!C.some(function(t){return t.entries.includes(e.name)})}),w=qe()({data:M,options:{shouldSort:!0,findAllMatches:!0,keys:["name"],caseSensitive:!1}}),T=w.result,k=w.search,R=(w.term,w.reset,T),x=function(){y([])},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(e,t,n){n({type:"UPDATE_MAPPING",payload:{id:e.id,mapping:{entries:[].concat(Object(u.a)(e.entries),Object(u.a)(t))}}})}(S,e,D),t&&x()},I=function(e){i(e),k(e)},U=N&&S,F=U?p(S.entries,S.negative_examples,M,N):[],G={text:U?Ce(S.entries,M):[],meaning:F},V=A(),B=V.cache_loaded,z=(V._,{mappings:C.length,total_rows:_.reduce(function(e,t){return e+t.count},0),total_mapped_rows:C.map(function(e){return e.entries.reduce(function(e,t){return e+_.find(function(e){return e.name===t}).count},0)}).reduce(function(e,t){return e+t},0),total_entries_in_mappings:C.reduce(function(e,t){return e+t.entries.length},0)});return B?r.a.createElement("h1",null,"Loading"):r.a.createElement("div",{className:"ColumnPage"},r.a.createElement(ae,{style:{gridArea:"header",width:"50%",justifySelf:"center"},onChange:I,onClear:function(){return I("")},value:o,prompt:"Search for entries by typing here..."}),r.a.createElement(Ue,Object.assign({entries:R,style:{gridArea:"table",overflowY:"hidden",width:"100%",height:"100%"},onToggleSelection:function(e){var t="string"==typeof e?e:e.name;O.includes(t)?y(O.filter(function(e){return e!=t})):y([].concat(Object(u.a)(O),[t]))},selection:O,onClearSelection:x},_)),r.a.createElement("div",{className:"StatsAndActions"},r.a.createElement("div",{className:"stats"},r.a.createElement("p",null,r.a.createElement("span",null,z.total_entries_in_mappings)," /"," ",r.a.createElement("span",null,_.length)," entries |"," ",r.a.createElement("span",null,z.total_mapped_rows)," /"," ",r.a.createElement("span",null,z.total_rows)," rows")),r.a.createElement("div",{className:"entryActionButtons"},r.a.createElement("button",{disabled:0==O.length,onClick:function(){var e=g(O,v,O[0],D);y([]),E(e)}},"New Mapping ",O.length),r.a.createElement("button",{disabled:!(O.length>0&&d),onClick:function(){return L(O,!0)}},"Add to Mapping"),r.a.createElement("button",{onClick:function(){return g(M,v,"Other",D)}},"Map Remaining To Other"))),r.a.createElement(Be,Object.assign({mappings:C,selection:C.find(function(e){return e.id===d}),style:{gridArea:"mappings"},onMappingSelected:function(e){return E(e.id)},onRenameMapping:function(e,t){!function(e,t,n){n({type:"UPDATE_MAPPING",payload:{mapping:{name:t},id:e.id}})}(e,t,D)},onRemoveEntryFromMapping:function(e,t){!function(e,t,n){console.log("mapping ",e," entry ",t),n({type:"UPDATE_MAPPING",payload:{id:e.id,mapping:{entries:e.entries.filter(function(e){return e!==t})}}})}(t,e,D)},onDeleteMapping:function(e){!function(e,t){t({type:"REMOVE_MAPPING",payload:e.id})}(e,D)},onClearMapping:function(e){!function(e,t){t({type:"UPDATE_MAPPING",payload:{id:e.id,mapping:{entries:[]}}})}(e,D)},suggestions:G,onAddSuggestionToMapping:function(e){return L([e])},onAddNegativeExampleToMapping:function(e){!function(e,t,n){n({type:"UPDATE_MAPPING",payload:{id:e.id,mapping:{negative_examples:[].concat(Object(u.a)(e.negative_examples),[t])}}})}(S,e,D)}},C,{syle:{height:"300px"}})))}function We(e){var t=e.project,n=e.stats;return r.a.createElement("div",{className:"project-card card"},r.a.createElement("h2",{className:"title"},t.name),r.a.createElement("p",{className:"description"},t.description),r.a.createElement("div",{className:"project-card-stats"},r.a.createElement("span",null,n.columns," ",r.a.createElement(x.a,{icon:R.b})),r.a.createElement("span",null,n.datasets," ",r.a.createElement(x.a,{icon:R.c})),r.a.createElement("span",null,n.meta_columns," ",r.a.createElement(x.a,{icon:R.c}))))}var He=function(e){var t=e.prompt,n=e.icon;return r.a.createElement("div",{className:"project-card card new-project-card"},r.a.createElement("h2",{className:"title"},t),r.a.createElement(x.a,{icon:n,size:"3x"}))};function Ye(){var e=M(),t=w(),n=(t.persisting,t.quota),a=t.usage;return r.a.createElement("div",{className:"welcome-page page"},r.a.createElement("header",{className:"welcome-page-header"},r.a.createElement("h1",{className:"large-title-header"},"smooshr"),r.a.createElement("p",null,"Wrangle those messy datasets"),r.a.createElement("p",{className:"feedback"},"We need your help to make smooshr better! Try out our"," ",r.a.createElement("a",{target:"_blank",href:"https://docs.google.com/document/d/1ANrFqNZKCYR4LogOKPvYVHZAbp1iiK3gpknPlNZF6Lw/"},"tutorial")," ","and leave your thoughts on our"," ",r.a.createElement("a",{target:"_blank",href:"https://airtable.com/shrMCZrvP7467LNG7"},"feedback form"))),e&&r.a.createElement("div",{className:"projects-area"},r.a.createElement("div",{className:""},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,"local projects")),r.a.createElement("div",{className:"region-list"},e.map(function(e){return r.a.createElement(i.b,{to:"/project/".concat(e.project.id)},r.a.createElement(We,{project:e.project,stats:e.stats}))}),r.a.createElement(i.b,{to:"/new_project"},r.a.createElement(He,{prompt:"New Project",icon:R.k})),r.a.createElement(i.b,{to:"/load_project"},r.a.createElement(He,{prompt:"Load Project",icon:R.o}))))),r.a.createElement("div",{className:"Storage"},r.a.createElement("p",null,"smooshr processes and stores all data locally on your machine."),n&&r.a.createElement("p",null,"It is currently using ",a.toLocaleString()," Mb of"," ",n.toLocaleString()," Mb.")))}var Ze=n(200);function Ke(e){var t=e.name,n=e.description,a=(e.id,e.fromColumns),c=e.selected,o=e.onClick,l=e.onUpdate,s=e.onUnmerge,u=e.link,m=a.reduce(function(e,t){return e+t.unique},0);return r.a.createElement("div",{onClick:o,className:"column-card card ".concat(c?"selected":"")},r.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},r.a.createElement(Fe,{text:t,onUpdate:l}),r.a.createElement("h2",null,m)),r.a.createElement("p",{className:"description"},n),a.map(function(e){return r.a.createElement("p",null,e.name," | ",e.dataset.name)}),r.a.createElement("div",{className:"column-action-buttons"},a.length>1&&r.a.createElement("button",{onClick:s},"Split Column"),r.a.createElement(i.b,{className:"work-on-taxonomy-button",to:u},r.a.createElement("button",null,"Work on taxonomy"))))}function Qe(e){var t=e.match,n=e.history,c=t.params.projectID,o=D(c),s=o.project,m=o.datasets,p=o.meta_columns,d=o.columns,f=o.mappings,g=o.entries,h=o.deleteProject,b=Object(a.useState)(m&&m.length>0?m[0].name:null),O=Object(l.a)(b,2),y=O[0],v=O[1];Object(a.useEffect)(function(){m.length>0&&!y&&v(m[0].name)},[m,y]);var j=m.find(function(e){return e.name===y}),_=A(),C=Object(l.a)(_,2);Object(Ze.a)(C[0]);var N=C[1],S=Object(a.useState)([]),P=Object(l.a)(S,2),M=P[0],w=P[1],T=function(e){!function(e,t){e.columns.forEach(function(n){t({type:"CREATE_META_COLUMN_FROM_COL_ID",payload:{col_id:n,id:E(),project_id:e.project_id}})}),t({type:"REMOVE_META_COLUMNS",payload:[e.id]}),t({type:"REMOVE_MAPPINGS_FOR_METACOLUMN",payload:e.id})}(p.find(function(t){return t.id==e}),N)},k=function(e){var t=d.find(function(t){return t.id===e});return{dataset:m.find(function(e){return e.id===t.dataset_id}),name:t.name,id:t.id,unique:t.unique}};return r.a.createElement("div",{className:"dataset-page page"},s?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,s.description),r.a.createElement("div",{className:"metadata region"},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,r.a.createElement(x.a,{icon:R.j,style:{marginRight:"20px"}}),"Metadata"),r.a.createElement("div",{className:"metadata"}))),r.a.createElement("div",{className:"columns region"},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,r.a.createElement(x.a,{icon:R.b,style:{marginRight:"20px"}}),"Columns"),M.length>0?r.a.createElement("button",{onClick:function(){!function(e,t){var n=e[0],a=e.map(function(e){return e.id});e.slice(1).forEach(function(e){n.columns=[].concat(Object(u.a)(n.columns),Object(u.a)(e.columns))}),t({type:"REMOVE_META_COLUMNS",payload:a}),t({type:"ADD_META_COLUMNS",payload:[n]})}(p.filter(function(e){return M.includes(e.id)}),N),w([])}},"Merge ".concat(M.length," columns")):""),r.a.createElement("div",{className:"region-list column-list"},p.map(function(e){return r.a.createElement(Ke,{name:e.name,description:e.description,fromColumns:e.columns.map(k),selected:M.includes(e.id),onClick:function(){return t=e.id,void(M.includes(t)?w(M.filter(function(e){return e!==t})):w([].concat(Object(u.a)(M),[t])));var t},onUpdate:function(t){return function(e,t){!function(e,t,n){n({type:"UPDATE_META_COLUMN",payload:{id:e,meta_column:t}})}(e.id,{name:t},N)}(e,t)},onUnmerge:function(){return T(e.id)},link:"/project/".concat(s.id,"/column/").concat(e.id)})}))),r.a.createElement("div",{className:"datasets region"},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,r.a.createElement(x.a,{icon:R.c,style:{marginRight:"20px"}}),"Datasets")),r.a.createElement("div",{className:"dataset-tabs"},m.map(function(e){return r.a.createElement("p",{className:y==e.name?"selected-dataset dataset-tab":"dataset-tab",onClick:function(){return v(e.name)}},e.name)}),r.a.createElement("p",{className:"final-dataset dataset-tab"},"Final Dataset Preview"),r.a.createElement("div",{class:"spacer"}),r.a.createElement(i.b,{to:"/project/".concat(c,"/add_datasets"),className:"add-dataset dataset-tab"},r.a.createElement(x.a,{icon:R.k}),r.a.createElement("span",null,"Add Dataset"))),m.length>0&&j&&r.a.createElement(Te,{data:j.sample,columns:j.columns})),r.a.createElement("div",{className:"actions region"},r.a.createElement("div",{className:"region-header"},r.a.createElement("h2",null,r.a.createElement(x.a,{icon:R.h,style:{marginRight:"20px"}}),"Actions")),r.a.createElement("div",{className:"region-list action-list"},r.a.createElement("button",{onClick:function(){Q(s,m,p,d,f,g,{})}},"Export Project"),r.a.createElement(i.b,{to:"/project/".concat(c,"/export")},r.a.createElement("button",null,"Export Python code")),r.a.createElement("button",{onClick:function(){h(),n.push("/")}},"Delete Project")))):r.a.createElement("h1",null,"Project not found"))}n(358),n(359);var $e=function(){var e=A(),t=Object(l.a)(e,2);return t[0].projects,t[1],r.a.createElement(i.a,{basename:"/Smooshr"},r.a.createElement(fe,null),r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"main"},r.a.createElement(de.b,{path:"/project/:projectID/dataset/:datasetID",exact:!0,component:ke}),r.a.createElement(de.b,{path:"/project/:projectID/column/:columnID",exact:!0,component:Je}),r.a.createElement(de.b,{path:"/project/:projectID",exact:!0,component:Qe}),r.a.createElement(de.b,{path:"/",exact:!0,component:Ye})),r.a.createElement(U,null),r.a.createElement(de.b,{path:"/",component:L}),r.a.createElement(de.b,{path:"/new_project",component:me}),r.a.createElement(de.b,{path:"/load_project",component:pe}),r.a.createElement(de.b,{path:"/project/:projectID/export",component:Oe}),r.a.createElement(de.b,{path:"/project/:projectID/add_datasets",component:ue}),r.a.createElement(de.b,{path:"/dataset/:datasetID/apply",component:be}),r.a.createElement(de.b,{path:"/project/:projectID/dataset/:datasetID/column/:columnID/guess_categories",component:Pe})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(function(e){var t=e.children,n=Object(a.useReducer)(N,_),c=Object(l.a)(n,2),o=c[0],i=c[1],s=o.datasets,u=o.columns,m=o.entries,p=o.projects,d=o.mappings,f=o.metaColumns,E=o.showUploadModal,g=o.showApplyMappingsModal;return Object(a.useEffect)(function(){o.cache_loaded&&(j.state.put({data:JSON.stringify(o),id:1}),navigator.storage&&navigator.storage.estimate?navigator.storage.estimate().then(function(e){var t=e.quota,n=e.usage;i({type:"UPDATE_STORAGE_QUOTA",payload:{quota:t,usage:n}})}):console.error("StorageManager not found"))},[s,u,m,p,d,f,E,g]),Object(a.useEffect)(function(){navigator.storage&&navigator.storage.persist&&navigator.storage.persist().then(function(e){i({type:"SET_PERSISTING",payload:e})})},[]),Object(a.useEffect)(function(){console.log("State update ",o)},[o]),Object(a.useEffect)(function(){j.state.get(1).then(function(e){if(e){var t=JSON.parse(e.data);console.log("ATTEMPTING TO HYDRATE STATE",t),i({type:"LOAD_CACHED_STATE",payload:O({},_,{},t,{cache_loaded:!0})})}else i({type:"LOAD_CACHED_STATE",payload:O({},_,{cache_loaded:!0})})})},[]),r.a.createElement(v.Provider,{value:[o,i]},t)},null,r.a.createElement($e,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[203,1,2]]]);
//# sourceMappingURL=main.fa452a8d.chunk.js.map